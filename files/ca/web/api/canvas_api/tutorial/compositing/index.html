---
title: Composició i retall
slug: Web/API/Canvas_API/Tutorial/Compositing
tags:
  - Canvas
  - Graphics
  - HTML
  - HTML5
  - Intermediate
  - Tutorial
translation_of: Web/API/Canvas_API/Tutorial/Compositing
original_slug: Web/API/Canvas_API/Tutorial/Composició
---
<div><section id="Quick_Links">
 <ol>
  <li><a href="/ca/docs/Web/API/Canvas_API"><strong>Canvas API</strong></a></li>
  <li class="toggle">
    <details open>
      <summary>Canvas tutorial</summary>
      <ol>
        <li><a href="/ca/docs/Web/API/Canvas_API/Tutorial/Basic_usage">Basic usage</a></li>
        <li><a href="/ca/docs/Web/API/Canvas_API/Tutorial/Drawing_shapes">Drawing shapes</a></li>
        <li><a href="/ca/docs/Web/API/Canvas_API/Tutorial/Applying_styles_and_colors">Applying styles and colors</a></li>
        <li><a href="/ca/docs/Web/API/Canvas_API/Tutorial/Drawing_text">Drawing text</a></li>
        <li><a href="/ca/docs/Web/API/Canvas_API/Tutorial/Using_images">Using images</a></li>
        <li><a href="/ca/docs/Web/API/Canvas_API/Tutorial/Transformations">Transformations</a></li>
        <li><a href="/ca/docs/Web/API/Canvas_API/Tutorial/Compositing">Compositing and clipping</a></li>
        <li><a href="/ca/docs/Web/API/Canvas_API/Tutorial/Basic_animations">Basic animations</a></li>
        <li><a href="/ca/docs/Web/API/Canvas_API/Tutorial/Advanced_animations">Advanced animations</a></li>
        <li><a href="/ca/docs/Web/API/Canvas_API/Tutorial/Pixel_manipulation_with_canvas">Pixel manipulation</a></li>
        <li><a href="/ca/docs/Web/API/Canvas_API/Tutorial/Hit_regions_and_accessibility">Hit regions and accessibility</a></li>
        <li><a href="/ca/docs/Web/API/Canvas_API/Tutorial/Optimizing_canvas">Optimizing the canvas</a></li>
        <li><a href="/ca/docs/Web/API/Canvas_API/Tutorial/Finale">Finale</a></li>
        </ol>
    </details>
  </li>
  <li class="toggle">
    <details open>
      <summary>Examples</summary>
      <ol>
        <li><a href="/ca/docs/Web/API/Canvas_API/A_basic_ray-caster">A basic raycaster</a></li>
        <li><a href="/ca/Add-ons/Code_snippets/Canvas">Canvas code snippets</a></li>
        <li><a href="/ca/docs/Web/API/Canvas_API/Manipulating_video_using_canvas">Manipulating video using canvas</a></li>
      </ol>
    </details>
  </li>
  <li class="toggle">
    <details open>
      <summary>Interfaces</summary>
      <ol>
        <li><a href="/ca/docs/Web/API/HTMLCanvasElement"><code>HTMLCanvasElement</code></a></li>
        <li><a href="/ca/docs/Web/API/CanvasRenderingContext2D"><code>CanvasRenderingContext2D</code></a></li>
        <li><a href="/ca/docs/Web/API/CanvasGradient"><code>CanvasGradient</code></a></li>
        <li><a href="/ca/docs/Web/API/CanvasPattern"><code>CanvasPattern</code></a></li>
        <li><a href="/ca/docs/Web/API/ImageBitmap"><code>ImageBitmap</code></a></li>
        <li><a href="/ca/docs/Web/API/ImageData"><code>ImageData</code></a></li>
        <li><a href="/ca/docs/Web/API/TextMetrics"><code>TextMetrics</code></a></li>
        <li><span class="sidebar-icon"><span title="This is an experimental API that should not be used in production code."><i class="icon-beaker"> </i></span></span> <a href="/ca/docs/Web/API/Path2D"><code>Path2D</code></a></li>
      </ol>
    </details>
  </li>
  <li><strong><a href="/ca/docs/MDN">Documentation:</a></strong></li>
  <li class="toggle">
    <details>
      <summary>Useful lists</summary>
      <ol>
        <li><a href="/ca/docs/tag/Canvas">Pages tagged &quot;Canvas&quot;</a></li>
      </ol>
    </details>
  </li>
  <li class="toggle">
    <details>
      <summary>Contribute</summary>
      <ol>
        <li><a href="/ca/docs/MDN/Doc_status/API/Canvas">Canvas doc status</a></li>
        <li><a href="/ca/docs/MDN">The MDN project</a></li>
      </ol>
    </details>
  </li>
 </ol>
</section> <div style="text-align: right;" class="prevnext">
    <p><a style="float: left;" href="/ca/docs/Web/API/Canvas_API/Tutorial/Transformations" class="button">« Previous</a><a href="/ca/docs/Web/API/Canvas_API/Tutorial/Basic_animations" class="button">Next  »</a></p>
</div></div>

<div class="summary">
<p>En tots els nostres <a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Transformations">exemples anteriors</a>, les formes sempre s&apos;han dibuixat una damunt de l&apos;altra. Això és més que adequat per a la majoria de les situacions, però limita l&apos;ordre en què es construeixen formes compostes. No obstant això, podem canviar aquest comportament establint la propietat <code>globalCompositeOperation</code>. A més, la propietat <code>clip</code> permet ocultar parts de formes no desitjades.</p>
</div>

<h2 id="globalCompositeOperation" name="globalCompositeOperation"><code>globalCompositeOperation</code></h2>

<p>No només podem dibuixar noves formes darrere de les formes existents, sinó que també, podem utilitzar-ho per emmascarar certes àrees, esborrar seccions del llenç (no limitades a rectangles, com ho fa el mètode <a href="/ca/docs/Web/API/CanvasRenderingContext2D/clearRect" title="Aquesta pàgina encara no ha estat traduïda. Si us plau considera contribuir-hi!"><code>clearRect()</code></a>) i molt més.</p>

<dl>
 <dt><a href="/ca/docs/Web/API/CanvasRenderingContext2D/globalCompositeOperation" title="Aquesta pàgina encara no ha estat traduïda. Si us plau considera contribuir-hi!"><code>globalCompositeOperation = type</code></a></dt>
 <dd>Estableix el tipus d&apos;operació de composició que s&apos;aplicarà en dibuixar noves formes, on el tipus és una cadena que identifica quina de les dotze operacions de composició ha d&apos;utilitzar-se.</dd>
</dl>

<p>Veure <a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Compositing/Example">exemples de composició</a> per al codi dels següents exemples.</p>

<p><iframe src="https://mdn.mozillademos.org/ca/docs/Web/API/Canvas_API/Tutorial/Compositing/Example$samples/Compositing_example?revision=1324356" width="750" class="live-sample-frame sample-code-frame" height="6750" frameborder="0" id="frame_Compositing_example"></iframe></p>

<h2 id="Clipping_paths" name="Clipping_paths">Trajectòries de retall</h2>

<p><img src="https://mdn.mozillademos.org/files/209/Canvas_clipping_path.png" alt style="float: right;" class="internal">Una trajectòria de retall és com una forma de llenç normal, però actua com una màscara per ocultar parts no desitjades de formes. Això es visualitza en la imatge de la dreta. La forma d&apos;estel vermell és la nostre trajectòria de retall. Tot el que queda fora d&apos;aquesta trajectòria no es dibuixarà en el llenç.</p>

<p>Si comparem les trajectòries de retall  amb la propietat <code>globalCompositeOperation</code>, que hem vist anteriorment, veiem dos modes de composició que aconsegueixen més o menys el mateix efecte en <code>source-in</code> i <code>source-atop</code>. Les diferències més importants entre les dues, són que les trajectòries de retall mai es dibuixen realment al llenç i la trajectòria de retall mai es veu afectada per l&apos;addició de noves formes. Això fa que les trajectòries de retall siguin ideals per dibuixar múltiples formes en un àrea restringida</p>

<p>En el capítol sobre <a href="https://developer.mozilla.org/en-US/docs/Web/API/Canvas_API/Tutorial/Drawing_shapes">dibuixar formes</a>, només s&apos;ha esmentat els mètodes <code>stroke()</code> i <code>fill()</code>, però hi ha un tercer mètode que es pot utilitzar amb les trajectòries, anomenat <code>clip()</code>.</p>

<dl>
 <dt><a href="/ca/docs/Web/API/CanvasRenderingContext2D/clip" title="Aquesta pàgina encara no ha estat traduïda. Si us plau considera contribuir-hi!"><code>clip()</code></a></dt>
 <dd>Converteix la trajectòria que s&apos;està construint, en la trajectòria de retall actual.</dd>
</dl>

<p>Utilitzar <code>clip()</code> en lloc de <code>closePath()</code> per tancar una trajectòria i convertir-la en una trajectòria de retall en lloc de traçar o emplenar la trajectòria.</p>

<p>Per defecte, l&apos;element <a href="/ca/docs/Web/HTML/Element/canvas" title="L&apos;element HTML &lt;canvas&gt; es pot utilitzar per dibuixar gràfics a través de seqüències d&apos;ordres (normalment JavaScript). Per exemple, es pot utilitzar per dibuixar gràfics, fer composicions de fotos o fins i tot realitzar animacions. Pots (i has de) proporcionar contingut alternatiu dins del bloc &lt;canvas&gt;. Aquest contingut es representarà tant en navegadors antics que no suporten canvas com en navegadors amb  JavaScript desactivat."><code>&lt;canvas&gt;</code></a>, té una trajectòria de retall de la mateixa grandària que el propi llenç. En altres paraules, no es produeix cap retall.</p>

<h3 id="A_clip_example" name="A_clip_example">Un exemple de <code>clip</code></h3>

<p>En aquest exemple, utilitzarem un trajectòria de retall circular per restringir el dibuix d&apos;un conjunt d&apos;estels aleatòries a una regió en particular.</p>

<pre class="brush: js;highlight[9]">function draw() {
  var ctx = document.getElementById(&apos;canvas&apos;).getContext(&apos;2d&apos;);
  ctx.fillRect(0, 0, 150, 150);
  ctx.translate(75, 75);

  // Crea una trajectòria de retall circular
  ctx.beginPath();
  ctx.arc(0, 0, 60, 0, Math.PI * 2, true);
  ctx.clip();

  // dibuixa el fons
  var lingrad = ctx.createLinearGradient(0, -75, 0, 75);
  lingrad.addColorStop(0, &apos;#232256&apos;);
  lingrad.addColorStop(1, &apos;#143778&apos;);

  ctx.fillStyle = lingrad;
  ctx.fillRect(-75, -75, 150, 150);

  // dibuixa els estels
  for (var j = 1; j &lt; 50; j++) {
    ctx.save();
    ctx.fillStyle = &apos;#fff&apos;;
    ctx.translate(75 - Math.floor(Math.random() * 150),
                  75 - Math.floor(Math.random() * 150));
    drawStar(ctx, Math.floor(Math.random() * 4) + 2);
    ctx.restore();
  }

}

function drawStar(ctx, r) {
  ctx.save();
  ctx.beginPath();
  ctx.moveTo(r, 0);
  for (var i = 0; i &lt; 9; i++) {
    ctx.rotate(Math.PI / 5);
    if (i % 2 === 0) {
      ctx.lineTo((r / 0.525731) * 0.200811, 0);
    } else {
      ctx.lineTo(r, 0);
    }
  }
  ctx.closePath();
  ctx.fill();
  ctx.restore();
}
</pre>

<div class="hidden">
<pre class="brush: html">&lt;canvas id=&quot;canvas&quot; width=&quot;150&quot; height=&quot;150&quot;&gt;&lt;/canvas&gt;</pre>

<pre class="brush: js">draw();</pre>
</div>

<p>En les primeres línies de codi, dibuixem un rectangle negre de la grandària del llenç com a fons, després traslladem l&apos;origen al centre. A continuació, creem la trajectòria de retall circular, dibuixant un arc i cridem <code>clip()</code>. Les trajectòries de retall també formen part de l&apos;estat de guardat del llenç. Si haguéssim volgut mantenir la trajectòria de retall original, podríem haver guardat l&apos;estat del llenç abans de crear el nou.</p>

<p>Tot el que es dibuixa després de crear la trajectòria de retall, només apareixerà dins d&apos;aquesta trajectòria. Es pot veure això clarament, en el gradient lineal que es dibuixa a continuació. Després d&apos;això, es dibuixa un conjunt de 50 estels posicionats aleatòriament i escalats, usant la funció personalitzada <code>drawStar()</code>. De nou, els estels, només apareixen dins de la trajectòria de retall definida.</p>

<p></p><table class="sample-code-table"><thead><tr><th scope="col" style="text-align: center;">Screenshot</th><th scope="col" style="text-align: center;">Live sample</th></tr></thead><tbody><tr><td><img src="https://mdn.mozillademos.org/files/208/Canvas_clip.png" alt class="internal"></td><td><iframe src="https://mdn.mozillademos.org/ca/docs/Web/API/Canvas_API/Tutorial/Composici%C3%B3$samples/A_clip_example?revision=1324356" width="180" class="live-sample-frame sample-code-frame" height="180" frameborder="0" id="frame_A_clip_example"></iframe></td></tr></tbody></table><p></p>

<p></p><div style="text-align: right;" class="prevnext">
    <p><a style="float: left;" href="/ca/docs/Web/API/Canvas_API/Tutorial/Transformations" class="button">« Previous</a><a href="/ca/docs/Web/API/Canvas_API/Tutorial/Basic_animations" class="button">Next  »</a></p>
</div><p></p>
