---
title: ボールを動かす
slug: Games/Tutorials/2D_Breakout_game_pure_JavaScript/Move_the_ball
translation_of: Games/Tutorials/2D_Breakout_game_pure_JavaScript/Move_the_ball
---
<div><section class="Quick_links" id="Quick_Links">
  <ol>
    <li class="toggle">
        <details>
            <summary>Web のゲーム開発紹介</summary>
            <ol>
              <li><a href="/ja/docs/Games/Introduction">Web のゲーム開発紹介</a></li>
              <li><a href="/ja/docs/Games/Anatomy">ビデオゲームとの違い</a></li>
              <li><a href="/ja/docs/Games/Examples">Examples</a></li>
            </ol>
        </details>
    </li>
    <li class="toggle">
        <details>
            <summary>ツール</summary>
            <ol>
              <li><a href="/ja/docs/Web/API/Canvas_API">Canvas</a></li>
              <li><a href="/ja/docs/Web/CSS">CSS</a></li>
              <li><a href="/ja/docs/Web/Apps/Fundamentals/User_notifications/Full_screen_api">Full screen</a></li>
              <li><a href="/ja/docs/Web/API/Gamepad_API">Gamepad</a></li>
              <li><a href="/ja/docs/Web/API/IndexedDB_API">IndexedDB</a></li>
              <li><a href="/ja/docs/Web/JavaScript">JavaScript</a></li>
              <li><a href="/ja/docs/Web/API/Pointer_Lock_API">Pointer Lock</a></li>
              <li><a href="/ja/docs/Web/SVG">SVG</a></li>
              <li><a href="/ja/docs/Web/JavaScript/Reference/Global_Objects/TypedArray">Typed Arrays</a></li>
              <li><a href="/ja/docs/Web/API/Web_Audio_API">Web Audio</a></li>
              <li><a href="/ja/docs/Web/API/WebGL_API">WebGL</a></li>
              <li><a href="/ja/docs/Web/API/WebRTC_API">WebRTC</a></li>
              <li><a href="/ja/docs/Web/API/WebSockets_API">WebSockets</a></li>
              <li><a href="/ja/docs/Web/API/WebVR_API">WebVR</a></li>
              <li><a href="/ja/docs/Web/API/Web_Workers_API">Web Workers</a></li>
              <li><a href="/ja/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a></li>
            </ol>
        </details>
    </li>
    <li class="toggle">
        <details>
            <summary>ゲーム開発テクニック</summary>
            <ol>
              <li><a href="/ja/docs/Games/Techniques/Async_scripts">asm.js の同期スクリプトを利用する</a></li>
              <li><a href="/ja/docs/Web/Apps/Developing/Optimizing_startup_performance">起動パフォーマンスを最適化する</a></li>
              <li><a href="/ja/docs/Games/Techniques/WebRTC_data_channels">ピア通信チャンネルとして WebRTC を利用する</a></li>
              <li><a href="/ja/docs/Games/Techniques/Efficient_animation_for_web_games">Web ゲームの効率的なアニメーション</a></li>
              <li><a href="/ja/docs/Games/Techniques/Audio_for_Web_Games">Web ゲーム向けの音</a></li>
              <li><a href="/ja/docs/Games/Techniques/2D_collision_detection">2D 衝突検出</a></li>
              <li><a href="/ja/docs/Games/Techniques/Tilemaps">タイルとタイルマップの概要</a></li>
            </ol>
        </details>
    </li>
    <li class="toggle">
        <details>
            <summary>Web上の 3D ゲームの概要</summary>
            <ol>
              <li><a href="/ja/docs/Games/Techniques/3D_on_the_web">Web上の 3D ゲームの概要</a></li>
              <li><a href="/ja/docs/Games/Techniques/3D_on_the_web/Basic_theory">基本の 3D理論の説明</a></li>
              <li><a href="/ja/docs/Games/Techniques/3D_on_the_web/Building_up_a_basic_demo_with_A-Frame">A-Frame</a></li>
              <li><a href="/ja/docs/Games/Techniques/3D_on_the_web/Building_up_a_basic_demo_with_Babylon.js">Babylon.js</a></li>
              <li><a href="/ja/docs/Games/Techniques/3D_on_the_web/Building_up_a_basic_demo_with_PlayCanvas">PlayCanvas を利用した基本的なデモの制作</a></li>
              <li><a href="/ja/docs/Games/Techniques/3D_on_the_web/Building_up_a_basic_demo_with_Three.js">Three.js を使った基本的なデモ製作</a></li>
              <li><a href="/ja/docs/Games/Techniques/3D_on_the_web/WebVR">WebVR</a></li>
              <li><a href="/ja/docs/Games/Techniques/3D_collision_detection">3D 衝突検出の概要</a></li>
              <li><a href="/ja/docs/Games/Techniques/3D_collision_detection/Bounding_volume_collision_detection_with_THREE.js">THREE.js を使ったバウンディングボリューム衝突検出</a></li>
            </ol>
        </details>
    </li>
    <li class="toggle">
        <details>
            <summary>Implementing game control mechanisms</summary>
            <ol>
              <li><a href="/ja/docs/Games/Techniques/Control_mechanisms">Control mechanisms</a></li>
              <li><a href="/ja/docs/Games/Techniques/Control_mechanisms/Mobile_touch">Mobile touch</a></li>
              <li><a href="/ja/docs/Games/Techniques/Control_mechanisms/Desktop_with_mouse_and_keyboard">Desktop with mouse and keyboard</a></li>
              <li><a href="/ja/docs/Games/Techniques/Control_mechanisms/Desktop_with_gamepad">Desktop with gamepad</a></li>
              <li><a href="/ja/docs/Games/Techniques/Control_mechanisms/Other">Other</a></li>
            </ol>
        </details>
    </li>
    <li class="toggle">
        <details>
            <summary>チュートリアル</summary>
            <ol>
              <li><a href="/ja/docs/Games/Tutorials/2D_Breakout_game_pure_JavaScript">そのままの JavaScript を使ったブロックくずしゲーム</a></li>
              <li><a href="/ja/docs/Games/Tutorials/2D_breakout_game_Phaser">Phaser を使ったブロックくずしゲーム</a></li>
              <li><a href="/ja/docs/Games/Tutorials/HTML5_Gamedev_Phaser_Device_Orientation">デバイス回転方向を使った 2D 迷路ゲーム</a></li>
              <li><a href="https://mozdevs.github.io/html5-games-workshop/en/guides/platformer/start-here/">Phaser を使った 2D プラットフォームゲーム</a></li>
            </ol>
        </details>
    </li>
    <li class="toggle">
        <details>
            <summary>ゲームを公開する</summary>
            <ol>
              <li><a href="/ja/docs/Games/Publishing_games">ゲームを公開するには</a></li>
              <li><a href="/ja/docs/Games/Publishing_games/Game_distribution">ゲームの配信</a></li>
              <li><a href="/ja/docs/Games/Publishing_games/Game_promotion">ゲームのプロモーション</a></li>
              <li><a href="/ja/docs/Games/Publishing_games/Game_monetization">ゲームのマネタイズ</a></li>
            </ol>
        </details>
    </li>
  </ol>
</section></div><div></div>

<p></p><div style="text-align: right;" class="prevnext">
    <p><a style="float: left;" href="/ja/docs/Games/Workflows/2D_Breakout_game_pure_JavaScript/Create_the_Canvas_and_draw_on_it" class="button">« 前のページ</a><a href="/ja/docs/Games/Workflows/2D_Breakout_game_pure_JavaScript/Bounce_off_the_walls" class="button">次のページ  »</a></p>
</div><p></p>

<div class="summary">
<p>これは<a href="https://developer.mozilla.org/en-US/docs/Games/Workflows/Breakout_game_from_scratch">ゲーム開発Canvasチュートリアル</a>の10ステップのうち<strong>2番目</strong>のステップです。このレッスンを終えたあとの完成予想のソースコードは<a href="https://github.com/end3r/Gamedev-Canvas-workshop/blob/gh-pages/lesson02.html">Gamedev-Canvas-workshop/lesson2.html</a>で入手できます。</p>
</div>

<p><span class="seoSummary">前回のレッスンを一通りこなしてみてボールの描き方が分かりました。では今回はそれを動かしましょう。技術的には、ボールを描画し、またそれを消してからほんの少し違う位置に描画し直すという処理を毎フレームずつ行うことで動いているような印象を生み出します。ちょうど映画がどのように動くのかと同じです。</span></p>

<h2 id="描画ループを定義する">描画ループを定義する</h2>

<p>Canvasの映像を毎フレーム、定期的に更新し続けるためには、何度も実行されるような関数を定義する必要があります。この関数には画像の位置を変えたりするために毎回違う値が与えらます。<a href="/ja/docs/Web/API/WindowTimers/setInterval" title="この項目についての文書はまだ書かれていません。書いてみませんか？"><code>setInterval()</code></a>や<a href="/ja/docs/Web/API/Window/requestAnimationFrame" title="window.requestAnimationFrame() メソッドは、ブラウザにアニメーションを行いたいことを知らせ、指定した関数を呼び出して次の再描画の前にアニメーションを更新することを要求します。このメソッドは、再描画の前に呼び出されるコールバック 1 個を引数として取ります。"><code>requestAnimationFrame()</code></a>といったJavaScriptのタイミング関数を用いれば同じ関数を何度も実行できます。</p>

<p>HTMLファイル内に既に書かれているJavaScriptを最初の2行を除いて全て削除し、次のコードを追記してください。<code>draw()</code>関数が<code>setInterval</code>の中で10ミリ秒おきに実行されます。</p>

<pre class="brush: js">function draw() {
    // 描画コード
}
setInterval(draw, 10);</pre>

<p>無限に続く <code>setInterval</code> の性質のため、<code>draw()</code>は10ミリ秒おきにずっと、あるいは私達が止めるまで呼ばれ続けます。では、ボールを描画してみましょう。<code>draw()</code>関数の中に下記のコードを追記してください。</p>

<pre class="brush: js">ctx.beginPath();
ctx.arc(50, 50, 10, 0, Math.PI*2);
ctx.fillStyle = &quot;#0095DD&quot;;
ctx.fill();
ctx.closePath();
</pre>

<p>では、書き換えたコードを試してみましょう。ボールが毎フレーム再描画されるはずです。</p>

<h2 id="ボール動かす">ボール動かす</h2>

<p>動きがないのでボールが再描画され続けていることに気づかないはずです。動きを加えてみましょう。まず、直書きされた位置 (50,50) のかわりに <code>x</code>、<code>y</code>という名の変数に開始位置を中央下端として定義し、それらを用いて円が描画される位置を定義します。</p>

<p>まず、<code>x</code>と<code>y</code>を定義するために自分の <code>draw()</code>関数の上に次の2行を追加しましょう。</p>

<pre class="brush: js">var x = canvas.width/2;
var y = canvas.height-30;
</pre>

<p>次に、<a href="/ja/docs/Web/API/CanvasRenderingContext2D/arc" title="Canvas 2D APIのCanvasRenderingContext2D.arc()メソッドは、パスに円弧を加えます。円弧の中心座標は(x, y)で半径がr、角度startAngleからendAngleまで、anticlockwiseの向きに描かれます(デフォルトは時計回り)。"><code>arc()</code></a>メソッド内で変数xと変数yを使うように<code>draw()</code> 関数を書き換えましょう。次のハイライトされている行のとおりです。</p>

<pre class="brush: js; highlight:[3]">function draw() {
    ctx.beginPath();
    ctx.arc(x, y, 10, 0, Math.PI*2);
    ctx.fillStyle = &quot;#0095DD&quot;;
    ctx.fill();
    ctx.closePath();
}
</pre>

<p>ここからが大事な部分です。<code>x</code>と<code>y</code>に毎フレーム描画した後に小さな値を加え、ボールが動いているように見せるのです。その小さな値を<code>dx</code>、<code>dy</code>として2、-2をそれぞれ設定しましょう。変数x、yの定義のあとに次のコードを追記してください。</p>

<pre class="brush: js">var dx = 2;
var dy = -2;
</pre>

<p>最後に残っていることがあります。フレームごとに<code>x</code>と<code>y</code>を変数<code>dx</code>、<code>dy</code>で更新して、更新されるたびにボールが新しい位置に描画されるようにするのです。次に示されている新しい2行を<code>draw()</code>関数の最後に追記してください。</p>

<pre class="brush: js; highlight:[7,8]">function draw() {
    ctx.beginPath();
    ctx.arc(x, y, 10, 0, Math.PI*2);
    ctx.fillStyle = &quot;#0095DD&quot;;
    ctx.fill();
    ctx.closePath();
    x += dx;
    y += dy;
}</pre>

<p>コードを保存してください。問題なく動作しますが、ボールの軌跡が残ります。</p>

<p><img src="https://mdn.mozillademos.org/files/10430/ball-trail.png" alt style="display: block; height: 320px; margin: 0px auto; width: 480px;"></p>

<h2 id="フレームの後にCanvasを消去する">フレームの後にCanvasを消去する</h2>

<p>前のフレームを削除せずに毎フレーム描画しているために軌跡が残ってしまいます。でも心配する必要はありません。Canvasの内容を消去するメソッド、<a href="/ja/docs/Web/API/CanvasRenderingContext2D/clearRect" title="CanvasRenderingContext2D.clearRect() は、座標 (x, y) を始点とする大きさ (width, height) の領域を、透明色（透明な黒）で塗りつぶします。領域内に描画されていたすべてのコンテンツは消去されます。"><code>clearRect()</code></a>があります。このメソッドは4つのパラメータをとります。四角形の左上端のx、y座標と四角形の右下端のx、y座標です。この四角形で囲われた領域にある内容全てが消去されます。</p>

<p>次のハイライトされている新しい行を<code>draw()</code>関数に追記してください。</p>

<pre class="brush: js; highlight:[2]">function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.beginPath();
    ctx.arc(x, y, 10, 0, Math.PI*2);
    ctx.fillStyle = &quot;#0095DD&quot;;
    ctx.fill();
    ctx.closePath();
    x += dx;
    y += dy;
}
</pre>

<p>コードを保存してもう一度試してみてください。今度は軌跡のないボールがみえるはずです。10ミリ秒おきにキャンバスは消去され、青い円 (ボール) が指定された位置に描画され、 <code>x</code>と<code>y</code>の値は次のフレームに備えて更新されます。</p>

<h2 id="コードを整える">コードを整える</h2>

<p>次のいくつかの記事では<code>draw()</code>関数にもっと命令を追加します。ですから<code>draw()</code>関数をできるだけ簡潔にしておくのは大事なことです。ボールを描画するコードを別の関数に移しましょう。</p>

<p>既にあるdraw()関数を次の2つの関数で置き換えてください。</p>

<pre class="brush: js">function drawBall() {
    ctx.beginPath();
    ctx.arc(x, y, 10, 0, Math.PI*2);
    ctx.fillStyle = &quot;#0095DD&quot;;
    ctx.fill();
    ctx.closePath();
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawBall();
    x += dx;
    y += dy;
}</pre>

<h2 id="自分のコードと比べる">自分のコードと比べる</h2>

<p>この記事で組み上げた自分のコードを下のライブデモで確認したり、書き換えたりしてどのように動いているかしっかり理解しましょう。</p>

<p> </p>

<p></p><p><iframe src="https://jsfiddle.net/end3r/3x5foxb1/embedded/" width="100%" height="395" frameborder="0"></iframe></p><p></p>

<p> </p>

<div class="summary">
<p>練習: 動くボールの速さや向きを変えてみましょう。</p>
</div>

<h2 id="次のステップ">次のステップ</h2>

<p>ボールを描画して動くようにしましたが、そのままCanvasの縁から消えていってしまいます。第3章ではどのように<a href="https://developer.mozilla.org/ja/docs/Games/Workflows/2D_Breakout_game_pure_JavaScript/Bounce_off_the_walls">ボールを壁で弾ませる</a>か探っていきます。</p>

<p></p><div style="text-align: right;" class="prevnext">
    <p><a style="float: left;" href="/ja/docs/Games/Workflows/2D_Breakout_game_pure_JavaScript/Create_the_Canvas_and_draw_on_it" class="button">« 前のページ</a><a href="/ja/docs/Games/Workflows/2D_Breakout_game_pure_JavaScript/Bounce_off_the_walls" class="button">次のページ  »</a></p>
</div><p></p>
