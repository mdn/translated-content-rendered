---
title: Переместить мяч
slug: Games/Tutorials/2D_Breakout_game_pure_JavaScript/Move_the_ball
tags:
  - 2D
  - Canvas
  - Игры
  - Обучение
  - Цикл
  - передвижение
  - пишем игру на javascript
translation_of: Games/Tutorials/2D_Breakout_game_pure_JavaScript/Move_the_ball
original_slug: Games/Tutorials/2D_Breakout_game_pure_JavaScript/Переместить_мяч
---
<div><section class="Quick_links" id="Quick_Links">
  <ol>
    <li class="toggle">
        <details>
            <summary>Introduction</summary>
            <ol>
              <li><a href="/ru/docs/Games/Introduction">Introduction</a></li>
              <li><a href="/ru/docs/Games/Anatomy">Anatomy</a></li>
              <li><a href="/ru/docs/Games/Examples">Examples</a></li>
            </ol>
        </details>
    </li>
    <li class="toggle">
        <details>
            <summary>APIs for game development</summary>
            <ol>
              <li><a href="/ru/docs/Web/API/Canvas_API">Canvas</a></li>
              <li><a href="/ru/docs/Web/CSS">CSS</a></li>
              <li><a href="/ru/docs/Web/Apps/Fundamentals/User_notifications/Full_screen_api">Full screen</a></li>
              <li><a href="/ru/docs/Web/API/Gamepad_API">Gamepad</a></li>
              <li><a href="/ru/docs/Web/API/IndexedDB_API">IndexedDB</a></li>
              <li><a href="/ru/docs/Web/JavaScript">JavaScript</a></li>
              <li><a href="/ru/docs/Web/API/Pointer_Lock_API">Pointer Lock</a></li>
              <li><a href="/ru/docs/Web/SVG">SVG</a></li>
              <li><a href="/ru/docs/Web/JavaScript/Reference/Global_Objects/TypedArray">Typed Arrays</a></li>
              <li><a href="/ru/docs/Web/API/Web_Audio_API">Web Audio</a></li>
              <li><a href="/ru/docs/Web/API/WebGL_API">WebGL</a></li>
              <li><a href="/ru/docs/Web/API/WebRTC_API">WebRTC</a></li>
              <li><a href="/ru/docs/Web/API/WebSockets_API">WebSockets</a></li>
              <li><a href="/ru/docs/Web/API/WebVR_API">WebVR</a></li>
              <li><a href="/ru/docs/Web/API/Web_Workers_API">Web Workers</a></li>
              <li><a href="/ru/docs/Web/API/XMLHttpRequest">XMLHttpRequest</a></li>
            </ol>
        </details>
    </li>
    <li class="toggle">
        <details>
            <summary>Techniques</summary>
            <ol>
              <li><a href="/ru/docs/Games/Techniques/Async_scripts">Using async scripts for asm.js</a></li>
              <li><a href="/ru/docs/Web/Apps/Developing/Optimizing_startup_performance">Optimizing startup performance</a></li>
              <li><a href="/ru/docs/Games/Techniques/WebRTC_data_channels">Using WebRTC peer-to-peer data channels</a></li>
              <li><a href="/ru/docs/Games/Techniques/Efficient_animation_for_web_games">Efficient animation for web games</a></li>
              <li><a href="/ru/docs/Games/Techniques/Audio_for_Web_Games">Audio for Web Games</a></li>
              <li><a href="/ru/docs/Games/Techniques/2D_collision_detection">2D collision detection</a></li>
              <li><a href="/ru/docs/Games/Techniques/Tilemaps">Tiles and tilemaps overview</a></li>
            </ol>
        </details>
    </li>
    <li class="toggle">
        <details>
            <summary>3D games on the Web</summary>
            <ol>
              <li><a href="/ru/docs/Games/Techniques/3D_on_the_web">3D games on the Web overview</a></li>
              <li><a href="/ru/docs/Games/Techniques/3D_on_the_web/Basic_theory">Explaining basic 3D theory</a></li>
              <li><a href="/ru/docs/Games/Techniques/3D_on_the_web/Building_up_a_basic_demo_with_A-Frame">Building up a basic demo with A-Frame</a></li>
              <li><a href="/ru/docs/Games/Techniques/3D_on_the_web/Building_up_a_basic_demo_with_Babylon.js">Building up a basic demo with Babylon.js</a></li>
              <li><a href="/ru/docs/Games/Techniques/3D_on_the_web/Building_up_a_basic_demo_with_PlayCanvas">Building up a basic demo with PlayCanvas</a></li>
              <li><a href="/ru/docs/Games/Techniques/3D_on_the_web/Building_up_a_basic_demo_with_Three.js">Building up a basic demo with Three.js</a></li>
              <li><a href="/ru/docs/Games/Techniques/3D_on_the_web/WebVR">WebVR</a></li>
              <li><a href="/ru/docs/Games/Techniques/3D_collision_detection">3D collision detection</a></li>
              <li><a href="/ru/docs/Games/Techniques/3D_collision_detection/Bounding_volume_collision_detection_with_THREE.js">Bounding volume collision detection with THREE.js</a></li>
            </ol>
        </details>
    </li>
    <li class="toggle">
        <details>
            <summary>Implementing game control mechanisms</summary>
            <ol>
              <li><a href="/ru/docs/Games/Techniques/Control_mechanisms">Control mechanisms</a></li>
              <li><a href="/ru/docs/Games/Techniques/Control_mechanisms/Mobile_touch">Mobile touch</a></li>
              <li><a href="/ru/docs/Games/Techniques/Control_mechanisms/Desktop_with_mouse_and_keyboard">Desktop with mouse and keyboard</a></li>
              <li><a href="/ru/docs/Games/Techniques/Control_mechanisms/Desktop_with_gamepad">Desktop with gamepad</a></li>
              <li><a href="/ru/docs/Games/Techniques/Control_mechanisms/Other">Other</a></li>
            </ol>
        </details>
    </li>
    <li class="toggle">
        <details>
            <summary>Tutorials</summary>
            <ol>
              <li><a href="/ru/docs/Games/Tutorials/2D_Breakout_game_pure_JavaScript">2D breakout game using pure JavaScript</a></li>
              <li><a href="/ru/docs/Games/Tutorials/2D_breakout_game_Phaser">2D breakout game using Phaser</a></li>
              <li><a href="/ru/docs/Games/Tutorials/HTML5_Gamedev_Phaser_Device_Orientation">2D maze_game with device orientation</a></li>
              <li><a href="https://mozdevs.github.io/html5-games-workshop/en/guides/platformer/start-here/">2D platform game using Phaser</a></li>
            </ol>
        </details>
    </li>
    <li class="toggle">
        <details>
            <summary>Publishing games</summary>
            <ol>
              <li><a href="/ru/docs/Games/Publishing_games">Publishing games overview</a></li>
              <li><a href="/ru/docs/Games/Publishing_games/Game_distribution">Game distribution</a></li>
              <li><a href="/ru/docs/Games/Publishing_games/Game_promotion">Game promotion</a></li>
              <li><a href="/ru/docs/Games/Publishing_games/Game_monetization">Game monetization</a></li>
            </ol>
        </details>
    </li>
  </ol>
</section></div>

<div></div>

<div class="prevnext" style="text-align: right;">
    <p><a href="/ru/docs/Games/Tutorials/2D_Breakout_game_pure_JavaScript/Создание_Canvas_и_рисование_на_нём" style="float: left;" class="button">« Предыдущая статья</a><a href="/ru/docs/Games/Tutorials/2D_Breakout_game_pure_JavaScript/Bounce_off_the_walls" class="button">Следующая статья  »</a></p>
</div>

<div class="summary">
<p>Это <strong>2й шаг</strong> из 10 <a href="https://developer.mozilla.org/en-US/docs/Games/Workflows/Breakout_game_from_scratch">Gamedev Canvas tutorial</a>. Вы можете найти исходный код для данного урока по ссылке <a href="https://github.com/end3r/Gamedev-Canvas-workshop/blob/gh-pages/lesson02.html">Gamedev-Canvas-workshop/lesson2.html</a>.</p>
</div>

<p><span class="seoSummary">Из предыдущей статьи Вы уже знаете, как нарисовать мяч, а сейчас давайте заставим его двигаться. Технически, мы будем рисовать мяч на экране, стирать его и рисовать заново на немного другой позиции каждый раз, чтобы создать эффект движения - точно так же, как это работает в фильмах.</span></p>

<h2 id="Определяем_цикл_рисования">Определяем цикл рисования</h2>

<p>Чтобы canvas постоянно обновлялся, необходимо определить функцию отрисовки, которая будет циклически запускаться с разными параметрами, чтобы изменять позицию элемента. Функцию можно циклически запускать с помощью JavaScript временной функции, такой как <a href="/ru/docs/Web/API/WindowTimers/setInterval" title="Документация об этом ещё не написана; пожалуйста, поспособствуйте её написанию!"><code>setInterval()</code></a> или <a href="/ru/docs/Web/API/Window/requestAnimationFrame" title="Документация об этом ещё не написана; пожалуйста, поспособствуйте её написанию!"><code>requestAnimationFrame()</code></a>.</p>

<p>Удалите весь JavaScript код, который сейчас хранился в Вашем HTML файле, за исключением первых двух строк, и добавьте следующий код после них. Функция <code>draw()</code> будет исполняться внутри функции <code>setInterval</code> каждые 10 мс:</p>

<pre class="brush: js">function draw() {
    // код отрисовки
}
setInterval(draw, 10);</pre>

<p>Благодаря бесконечности функции <code>setInterval</code> функция <code>draw()</code> будет выполняться каждые 10 мс бесконечно или же пока мы не остановим её. Теперь давайте нарисуем мяч - добавьте в свой код функцию <code>draw()</code>:</p>

<pre class="brush: js">ctx.beginPath();
ctx.arc(50, 50, 10, 0, Math.PI*2);
ctx.fillStyle = &quot;#0095DD&quot;;
ctx.fill();
ctx.closePath();
</pre>

<p>Попробуйте сейчас Ваш обновлённый код - каждый раз мяч будет перерисовываться.</p>

<h2 id="Перемещение">Перемещение</h2>

<p>Вы не можете определить, перерисовывается ли мяч в конкретный момент, так как его позиция не меняется. Давайте исправим это. Прежде всего, в позиции (50,50) определим стартовую точку в нижней центральной части Canvas в переменной <code>x</code> и <code>y</code>, и потом используем их для определения текущего положения мяча.</p>

<p>Для начала добавьте следующие две строки до функции <code>draw()</code>, чтобы определить переменные <code>x</code> и <code>y</code>:</p>

<pre class="brush: js">var x = canvas.width/2;
var y = canvas.height-30;
</pre>

<p>Далее обновите функцию <code>draw()</code>, чтобы использовать переменные x и y в методе <a href="/ru/docs/Web/API/CanvasRenderingContext2D/arc" title="CanvasRenderingContext2D.arc() метод Canvas 2D API добавляет дугу к пути с центром (x, y) и с радиусом r  с началом в startAngle и с концом endAngle и с направлением против часовой стрелки (по умолчанию по часовой стрелке)."><code>arc()</code></a>, как показано на подсвеченной линии:</p>

<pre class="brush: js; highlight:[3]">function draw() {
    ctx.beginPath();
    ctx.arc(x, y, 10, 0, Math.PI*2);
    ctx.fillStyle = &quot;#0095DD&quot;;
    ctx.fill();
    ctx.closePath();
}
</pre>

<p>Теперь важная часть: мы хотим добавлять небольшое значение к переменным <code>x</code> и <code>y</code> после каждой итерации, чтобы заставить мяч двигаться. Давайте определим эти небольшие значения в переменных <code>dx</code> и <code>dy</code> и установим их 2 и -2 соответственно. Добавьте следующий код после определения переменных x и y:</p>

<pre class="brush: js">var dx = 2;
var dy = -2;
</pre>

<p>И последнее, необходимо обновить переменные <code>x</code> и <code>y</code> на значение <code>dx</code> и <code>dy</code> каждую итерацию, чтобы мяч отрисовывался каждый раз на новой позиции. Добавьте ещё две строки кода в функции <code>draw()</code>:</p>

<pre class="brush: js; highlight:[7,8]">function draw() {
    ctx.beginPath();
    ctx.arc(x, y, 10, 0, Math.PI*2);
    ctx.fillStyle = &quot;#0095DD&quot;;
    ctx.fill();
    ctx.closePath();
    x += dx;
    y += dy;
}</pre>

<p>Сохраните Ваш код и откройте страницу в браузере. Всё работает хорошо, вот только мяч оставляет позади след:</p>

<p><img alt src="https://mdn.mozillademos.org/files/10430/ball-trail.png" style="display: block; height: 320px; margin: 0px auto; width: 480px;"></p>

<h2 id="Очищение_объекта_после_каждого_кадра">Очищение объекта после каждого кадра</h2>

<p>Мяч оставляет след, потому что мы рисуем круг на каждой итерации без удаления предыдущей отрисованной фигуры. Не переживайте, потому что существует метод для очистки canvas элемента: <a href="/ru/docs/Web/API/CanvasRenderingContext2D/clearRect" title="Метод CanvasRenderingContext2D.clearRect(), предоставляемый Canvas 2D API, устанавливает прозрачный черный цвет для всех пикселей, расположенных внутри прямоугольника, заданного начальной точкой (x, y) и размерами (width, height), таким образом стирая любое ранее нарисованное содержимое."><code>clearRect()</code></a>. Этот метод принимает четыре параметра: x и y координаты верхнего левого угла прямоугольника, x и y координаты нижнего правого угла прямоугольника. Вся площадь, покрытая прямоугольником, будет очищена от любого содержимого, которое когда-либо было там отрисовано.</p>

<p>Добавьте следующую подсвеченную строку в функцию <code>draw()</code>:</p>

<pre class="brush: js; highlight:[2]">function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.beginPath();
    ctx.arc(x, y, 10, 0, Math.PI*2);
    ctx.fillStyle = &quot;#0095DD&quot;;
    ctx.fill();
    ctx.closePath();
    x += dx;
    y += dy;
}
</pre>

<p>Сохраните Ваш код и попробуйте снова, и на этот раз Вы увидите, что мяч перемещается без следов. Каждые 10 мс canvas очищается, голубой круг (наш мяч) отрисовывается на заданной позиции, переменные <code>x</code> и <code>y</code> каждую итерацию обновляются.</p>

<h2 id="Рефакторинг">Рефакторинг</h2>

<p>Мы будем добавлять каждый раз всё больше команд в функцию <code>draw()</code>, поэтому было бы неплохо содержать наш код настолько простым и понятным, на сколько это возможно. Давайте вынесем команды перемещения мяча в отдельную функцию.</p>

<p>Замените существующую функцию draw() следующими двумя функциями:</p>

<pre class="brush: js">function drawBall() {
    ctx.beginPath();
    ctx.arc(x, y, 10, 0, Math.PI*2);
    ctx.fillStyle = &quot;#0095DD&quot;;
    ctx.fill();
    ctx.closePath();
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    drawBall();
    x += dx;
    y += dy;
}</pre>

<h2 id="Сравните_Ваш_код">Сравните Ваш код</h2>

<p>Вы можете проверить итоговый код для этого урока с помощью демо, а так же поэкспериментировать с ним, изменяя те или иные параметры:</p>

<p><iframe frameborder="0" height="395" src="https://jsfiddle.net/end3r/3x5foxb1/embedded/" width="100%"></iframe></p>

<div class="summary">
<p>Упражнение: попробуйте изменить скорость перемещения мяча, или направление перемещения.</p>
</div>

<h2 id="Следующие_шаги">Следующие шаги</h2>

<p>Мы нарисовали мяч и заставили его двигаться, но он продолжает пропадать на краю canvas. В третьей части мы рассмотрим, как заставить его <a href="https://developer.mozilla.org/en-US/docs/Games/Workflows/Breakout_game_from_scratch/Bounce_off_the_walls">отскакивать от стен</a>.</p>

<div class="prevnext" style="text-align: right;">
    <p><a href="/ru/docs/Games/Workflows/2D_Breakout_game_pure_JavaScript/Create_the_Canvas_and_draw_on_it" style="float: left;" class="button">« Предыдущая статья</a><a href="/ru/docs/Games/Workflows/2D_Breakout_game_pure_JavaScript/Bounce_off_the_walls" class="button">Следующая статья  »</a></p>
</div>
