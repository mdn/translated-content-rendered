---
title: Модификация веб страницы
slug: Mozilla/Add-ons/WebExtensions/Modify_a_web_page
translation_of: Mozilla/Add-ons/WebExtensions/Modify_a_web_page
original_slug: Mozilla/Add-ons/WebExtensions/модификация_веб_страницы
---
<p> </p>

<div><section class="Quick_links" id="Quick_Links">
  <ol>
    <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions"><strong>Browser extensions</strong></a></li>
    <li class="toggle">
      <details>
        <summary>Getting started</summary>
        <ol>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/What_are_WebExtensions">What are extensions?</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Your_first_WebExtension">Your first extension</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Your_second_WebExtension">Your second extension</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension">Anatomy of an extension</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Examples">Example extensions</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/What_next_">What next?</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>Concepts</summary>
        <ol>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Using_the_JavaScript_APIs">Using the JavaScript APIs</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Content_scripts">Content scripts</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Match_patterns">Match patterns</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Working_with_files">Working with files</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Internationalization">Internationalization</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Content_Security_Policy">Content Security Policy</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Native_messaging">Native messaging</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Differences_between_API_implementations">Differences between API implementations</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Chrome_incompatibilities">Chrome incompatibilities</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>User interface</summary>
        <ol>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/user_interface">User Interface</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/user_interface/Browser_action">Toolbar button</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/user_interface/Page_actions">Address bar button</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/user_interface/Sidebars">Sidebars</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/user_interface/Context_menu_items">Context menu items</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/user_interface/Options_pages">Options page</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/user_interface/Extension_pages">Extension pages</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/user_interface/Notifications">Notifications</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/user_interface/Omnibox">Address bar suggestions</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/user_interface/devtools_panels">Developer tools panels</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>How to</summary>
        <ol>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests">Intercept HTTP requests</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Modify_a_web_page">Modify a web page</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page">Insert external content</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Sharing_objects_with_page_scripts">Share objects with page scripts</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Add_a_button_to_the_toolbar">Add a button to the toolbar</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Implement_a_settings_page">Implement a settings page</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Working_with_the_Tabs_API">Work with the Tabs API</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Bookmarks_API">Work with the Bookmarks API</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Cookies_API">Work with the Cookies API</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Work_with_contextual_identities">Work with contextual identities</a></li>
          <li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Build_a_cross_browser_extension">Build a cross-browser extension</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Firefox_differentiators">Firefox differentiators</a></summary>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>JavaScript APIs</summary>
        <ol><li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/Browser_support_for_JavaScript_APIs">Browser support for JavaScript APIs</a></li><li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/API/cookies">cookies</a></li><li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/API/downloads">downloads</a></li><li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/API/runtime">runtime</a></li><li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/API/tabs">tabs</a></li><li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/API/windows">windows</a></li><li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/API/webRequest">webRequest</a></li></ol>
      </details>
    </li>
    <li class="toggle">
      <details>
      <summary>Manifest keys</summary>
      <ol><li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_security_policy">content_security_policy</a></li><li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/manifest.json/description">description</a></li><li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions">permissions</a></li><li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/manifest.json/background">ключ background</a></li><li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/manifest.json/icons">ключ icons</a></li><li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/manifest.json/manifest_version">ключ manifest_version</a></li><li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/manifest.json/name">ключ name</a></li><li><a href="/ru/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version">ключ version</a></li></ol>
      </details>
    </li>
     <li class="toggle">
      <details>
        <summary>Extension Workshop</summary>
        <ol>
          <li><a href="https://extensionworkshop.com/documentation/develop/">Develop</a></li>
          <li><a href="https://extensionworkshop.com/documentation/publish/">Publish</a></li>
          <li><a href="https://extensionworkshop.com/documentation/manage/">Manage</a></li>
          <li><a href="https://extensionworkshop.com/documentation/enterprise/">Enterprise</a></li>
        </ol>
      </details>
    </li>
    <li><a href="/ru/docs/Mozilla/Add-ons/Contact_us"><strong>Contact us</strong></a></li>
    <li class="toggle">
      <details>
        <summary>Channels</summary>
        <ol>
          <li><a href="https://blog.mozilla.org/addons">Add-ons blog</a></li>
          <li><a href="https://discourse.mozilla.org/c/add-ons">Add-ons forum</a></li>
          <li><a href="https://chat.mozilla.org/#/room/%23addons:mozilla.org">Add-ons chat</a></li>
        </ol>
      </details>
    </li>
  </ol>
</section></div>

<p>Одним из наиболее распространённых вариантов использования расширений является внесение изменение в веб-страницу. К примеру, расширение может изменить стиль, применённый к странице, скрыть существующие или вставить на страницу дополнительные DOM-узлы.</p>

<p>Существует два способа сделать это используя WebExtensions API:</p>

<ul>
 <li><strong>Декларативно</strong>: объявить шаблон, которому соответствует набор URL-адресов, и загрузить набор скриптов на страницы, которые попадают в под этот шаблон.</li>
 <li><strong>Программно</strong>: используя JavaScript API, загрузить скрипт на страницу, из определённой вкладки.</li>
</ul>

<p>В любом случае, эти скрипты называются <em>контентными скриптами</em>, и отличаются от других скриптов, которые составляют расширение:</p>

<ul>
 <li>Они получают доступ к малому подмножеству WebExtension API.</li>
 <li>Они получают прямой доступ к странице, на которой были загружены.</li>
 <li>Они взаимодействуют с остальными скриптами расширения, используя API сообщений.</li>
</ul>

<p>В этой статье мы рассмотрим оба способа загрузки скрипта.</p>

<h2 id="Модификация_страниц_подпадающих_под_URL-шаблон">Модификация страниц, подпадающих под URL-шаблон</h2>

<p>Прежде всего создадим новую директорию, назовём её &quot;modify-page&quot;. В этой директории, создадим файл &quot;manifest.json&quot;, со следующим содержимым:</p>

<pre class="brush: json notranslate">{

  &quot;manifest_version&quot;: 2,
  &quot;name&quot;: &quot;modify-page&quot;,
  &quot;version&quot;: &quot;1.0&quot;,

  &quot;content_scripts&quot;: [
    {
      &quot;matches&quot;: [&quot;https://developer.mozilla.org/*&quot;],
      &quot;js&quot;: [&quot;page-eater.js&quot;]
    }
  ]

}</pre>

<p>Ключ <code><a href="/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_scripts">content_scripts</a></code> - это как мы загружаем скрипты на страницы, соответстующие URL-шаблону. В нашем случае, <code>content_scripts</code> говорит браузеру загрузить скрипт &quot;page-eater.js&quot; на все страницы, начинающиеся с <a href="https://developer.mozilla.org/">https://developer.mozilla.org/</a>.</p>

<div class="note notecard">
<p>Поскольку свойство <code>&quot;js&quot;</code> ключа <code>content_scripts</code> это массив, вы можете использовать его, для внедрения более одного скрипта. Если вы сделаете это, страницы получат набор, как если бы эти скрипты были загружены самой страницей, они будут загружены в той же очерёдности, в которой они расположены в массиве.</p>
</div>

<div class="note notecard">
<p>Ключ <code>content_scripts</code> также имеет свойство  <code>&quot;css&quot;</code>, которое вы можете использовать для вставки CSS-таблиц.</p>
</div>

<p>Далее, создадим файл &quot;page-eater.js&quot;, внутри директории &quot;modify-page&quot;:</p>

<pre class="brush: js notranslate">document.body.textContent = &quot;&quot;;

var header = document.createElement(&apos;h1&apos;);
header.textContent = &quot;Эта страница была съедена&quot;;
document.body.appendChild(header);</pre>

<p>Теперь <a href="https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Temporary_Installation_in_Firefox">установим расширение</a>, и перейдём на страницу <a href="https://developer.mozilla.org/">https://developer.mozilla.org/</a>:</p>

<div class="intrinsic-wrapper"><div class="intrinsic-container "><iframe src="https://www.youtube.com/embed/lxf2Tkg6U1M?rel=0&amp;html5=1"></iframe></div></div>

<div class="note notecard">
<p>Обратите внимание, несмотря на то, что в указанном видео, на странице <a href="https://addons.mozilla.org/en-US/firefox/">addons.mozilla.org</a> всё работает нормально, на текущий момент, для этого сайта, контентные скрипты заблокированы.</p>
</div>

<h2 id="Программная_модификация_страницы">Программная модификация страницы</h2>

<p>Что, если вы всё еще хотите &quot;съедать&quot; страницы, но лишь в тех случаях, когда пользователь попросил об этом? Давайте обновим этот пример таким образом, чтобы мы внедряли контентный скрипт, когда пользователь выбирает соответствующий пункт контентного меню.</p>

<p>Для начала обновим &quot;manifest.json&quot;:</p>

<pre class="brush: json notranslate">{

  &quot;manifest_version&quot;: 2,
  &quot;name&quot;: &quot;modify-page&quot;,
  &quot;version&quot;: &quot;1.0&quot;,

  &quot;permissions&quot;: [
    &quot;activeTab&quot;,
    &quot;contextMenus&quot;
  ],

  &quot;background&quot;: {
    &quot;scripts&quot;: [&quot;background.js&quot;]
  }

}</pre>

<p>Мы удалили ключ <code>content_scripts</code> и добавили два новых:</p>

<ul>
 <li><code><a href="/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions">permissions (разрешения)</a></code>: для внедрения скрипта, нам нужны разрешения для страниц, которые мы модифицируем.  <a href="/en-US/Add-ons/WebExtensions/manifest.json/permissions#activeTab_permission">Разрешение <code>activeTab</code></a> это способ получить доступ к текущей вкладки. Нам также нужно разрешение <code>contextMenus</code>, чтобы добавлять в контектсное меню новые элементы.</li>
 <li><code><a href="/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/background">background (фоновый)</a></code>: мы используем этот ключ, для загрузки постоянного <a href="/en-US/Add-ons/WebExtensions/Anatomy_of_a_WebExtension#Background_scripts">&quot;фонового скрипта&quot;</a>, с именем &quot;background.js&quot;, в котором мы настроим контекстное меню и внедрим контентный скрипт.</li>
</ul>

<p>Давайте создадим этот файл. Создадим новый файл &quot;background.js&quot; в директории &quot;modify-page&quot; и поместим в него следующий код:</p>

<pre class="brush: js notranslate">browser.contextMenus.create({
  id: &quot;eat-page&quot;,
  title: &quot;Съесть эту страницу&quot;
});

browser.contextMenus.onClicked.addListener(function(info, tab) {
  if (info.menuItemId == &quot;eat-page&quot;) {
    browser.tabs.executeScript({
      file: &quot;page-eater.js&quot;
    });
  }
});
</pre>

<p>В этом скрипте мы создаём <a href="/en-US/Add-ons/WebExtensions/API/ContextMenus/create">элемент контекстного меню</a>, передавая ему определённый идентификатор и заголовок (текст будет отображаться в элементе контекстного меню). Затем мы настраиваем обработчик событий таким образом, чтобы когда пользователь выбирает пункт контекстного меню, осуществлялась проверка, наш ли это элемент <code>eat-page</code>. Если это так - внедряем скрипт &quot;page-eater.js&quot; в текущую вкладку, используя <code><a href="/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript">tabs.executeScript()</a></code> API. Это API опционально принимает идентификатор вкладки, в качестве аргумента. Мы опустили его, это означает, что скрипт будет внедряться в текущую активную вкладку.</p>

<p>На данном этапе расширение должно иметь следующий вид:</p>

<pre class="line-numbers  language-html notranslate"><code class="language-html">modify-page/
    background.js
    manifest.json
    page-eater.js</code></pre>

<p>Теперь <a href="https://developer.mozilla.org/en-US/Add-ons/WebExtensions/Temporary_Installation_in_Firefox#Reloading_a_temporary_add-on">перезагрузим расширение</a>, откроем страницу (на этот раз любую) активируем контекстное меню и выберем &quot;Съесть эту страницу&quot;:</p>

<div class="intrinsic-wrapper"><div class="intrinsic-container "><iframe src="https://www.youtube.com/embed/zX4Bcv8VctA?rel=0&amp;html5=1"></iframe></div></div>

<div class="note notecard">
<p>Обратите внимание, несмотря на то, что в указанном видео, на странице <a href="https://addons.mozilla.org/en-US/firefox/">addons.mozilla.org</a> всё работает нормально, на текущий момент, для этого сайта, контентные скрипты заблокированы.</p>
</div>

<h2 id="Обмен_сообщениями">Обмен сообщениями</h2>

<p>Контентные и фоновые скрипты не могут на прямую взаимодействовать друг с другом. Не смотря на это они могут взаимодействовать с помощью обмена сообщениями. Для этого один конец создаёт обработчик сообщений, а другой - может посылать сообщения. В следующей таблице представлены API-интерфейсы, задействованные с каждой стороны:</p>

<table class=" fullwidth-table standard-table">
 <thead>
  <tr>
   <th scope="row"></th>
   <th scope="col">В контентном скрипте</th>
   <th scope="col">В фоновом скрипте</th>
  </tr>
  <tr>
   <th scope="row">Отправка сообщения</th>
   <td><code><a href="/en-US/Add-ons/WebExtensions/API/runtime#sendMessage()">browser.runtime.sendMessage()</a></code></td>
   <td><code><a href="/en-US/Add-ons/WebExtensions/API/Tabs/sendMessage">browser.tabs.sendMessage()</a></code></td>
  </tr>
  <tr>
   <th scope="row">Получение сообщения</th>
   <td><code><a href="/en-US/Add-ons/WebExtensions/API/runtime/onMessage">browser.runtime.onMessage</a></code></td>
   <td><code><a href="/en-US/Add-ons/WebExtensions/API/runtime#onMessage">browser.runtime.onMessage</a></code></td>
  </tr>
 </thead>
</table>

<p>Давайте обновим наш пример, чтобы посмотреть, как послать сообщение из фонового скрипта.</p>

<p>Изменим &quot;background.js&quot; :</p>

<pre class="brush: js notranslate">browser.contextMenus.create({
  id: &quot;eat-page&quot;,
  title: &quot;Съесть эту страницу&quot;
});

function messageTab(tabs) {
  browser.tabs.sendMessage(tabs[0].id, {
    replacement: &quot;Message from the extension!&quot;
  });
}

browser.contextMenus.onClicked.addListener(function(info, tab) {
  if (info.menuItemId == &quot;eat-page&quot;) {
    browser.tabs.executeScript({
      file: &quot;page-eater.js&quot;
    });

    var querying = browser.tabs.query({
      active: true,
      currentWindow: true
    });
    querying.then(messageTab);
  }
});
</pre>

<p>Теперь, после внедрения &quot;page-eater.js&quot;, мы используем <code><a href="/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/query">tabs.query()</a></code>, чтобы получить текущую открытую вкладку и используем <code><a href="/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/sendMessage">tabs.sendMessage()</a></code>, для отправки сообщения контентному скрипту, загруженному на этой вкладке. Сообщение несёт полезную нагрузку <code>{replacement: &quot;Message from the extension!&quot;}</code>.</p>

<p>Далее, обновим &quot;page-eater.js&quot;:</p>

<pre class="brush: js notranslate">function eatPage(request, sender, sendResponse) {
  document.body.textContent = &quot;&quot;;

  var header = document.createElement(&apos;h1&apos;);
  header.textContent = request.replacement;
  document.body.appendChild(header);
}

browser.runtime.onMessage.addListener(eatPage);
</pre>

<p>Теперь, вместо простого &quot;поедания страницы&quot;, контентный скрипт ждёт сообщение, используя <code><a href="/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage">runtime.onMessage</a></code>. Когда сообщение получено, контентный скрипт выполняет в точности такой же код, как и а примере ранее, за исключением того, что заменяющий текст берётся из <code>request.replacement</code>.</p>

<p>Если мы хотим отправить сообщение наоборот, из контентного скрипта в фоновый, настройка будет обратной данному примеру, за исключением того, что мы будем использовать <code><a href="/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/sendMessage">runtime.sendMessage()</a></code> в контентном скрипте.</p>

<div class="note notecard">
<p>Все эти примеры внедряют JavaScript; вы можете программно внедрять стилевые таблицы CSS используя функцию <code><a href="/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/insertCSS">tabs.insertCSS()</a></code>.</p>
</div>

<h2 id="Узнать_больше">Узнать больше</h2>

<ul>
 <li>Руководство по <a href="/en-US/docs/Mozilla/Add-ons/WebExtensions/Content_scripts">Content scripts</a></li>
 <li>Ключ манифеста<code><a href="/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/content_scripts">content_scripts</a></code></li>
 <li>Ключ манифеста<code><a href="/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions">permissions</a></code></li>
 <li><code><a href="/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript">tabs.executeScript()</a></code></li>
 <li><code><a href="/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/insertCSS">tabs.insertCSS()</a></code></li>
 <li><code><a href="/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/sendMessage">tabs.sendMessage()</a></code></li>
 <li><code><a href="/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/sendMessage">runtime.sendMessage()</a></code></li>
 <li><code><a href="/en-US/docs/Mozilla/Add-ons/WebExtensions/API/runtime/onMessage">runtime.onMessage</a></code></li>
 <li>Примеры использования <code>content_scripts</code>:
  <ul>
   <li><a href="https://github.com/mdn/webextensions-examples/tree/master/borderify">borderify</a></li>
   <li><a href="https://github.com/mdn/webextensions-examples/tree/master/notify-link-clicks-i18n">notify-link-clicks-i18n</a></li>
   <li><a href="https://github.com/mdn/webextensions-examples/tree/master/page-to-extension-messaging">page-to-extension-messaging</a></li>
  </ul>
 </li>
 <li>Примеры использования <code>tabs.executeScript()</code>:
  <ul>
   <li><a class="external external-icon" href="https://github.com/mdn/webextensions-examples/tree/master/beastify">beastify</a></li>
   <li><a class="external external-icon" href="https://github.com/mdn/webextensions-examples/tree/master/context-menu-demo">context-menu-demo</a></li>
  </ul>
 </li>
</ul>
