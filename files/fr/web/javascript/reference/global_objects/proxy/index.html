---
title: Proxy
slug: Web/JavaScript/Reference/Global_Objects/Proxy
tags:
  - ECMAScript 2015
  - JavaScript
  - Proxy
  - Reference
translation_of: Web/JavaScript/Reference/Global_Objects/Proxy
original_slug: Web/JavaScript/Reference/Objets_globaux/Proxy
---
<div><section class="Quick_links" id="Quick_Links"><ol><li><strong><a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux">Objets standards</a></strong></li><li><strong><a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Proxy/handler"><code>Proxy/handler</code></a></strong></li></ol></section></div>

<p>L&apos;objet <strong>Proxy</strong> est utilisé afin de définir un comportement sur mesure pour certaines opérations fondamentales (par exemple, l&apos;accès aux propriétés, les affectations, les énumérations, les appels de fonctions, etc.).</p>

<h2 id="Terminologie">Terminologie</h2>

<dl>
 <dt><a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Proxy/handler">gestionnaire</a> (<em>handler</em>)</dt>
 <dd>Un objet qui contient les trappes qui intercepteront les opérations.</dd>
 <dt>trappes</dt>
 <dd>Les méthodes qui fournissent l&apos;accès aux propriétés. Ce concept est analogue aux <a href="https://en.wikipedia.org/wiki/Trap_%28computing%29">trappes</a> utilisées dans les systèmes d&apos;exploitations.</dd>
 <dt>cible</dt>
 <dd>L&apos;objet virtualisé par le proxy. Il est souvent utilisé comme objet de stockage. Les invariants (c&apos;est-à-dire les éléments de sémantique qui restent inchangés) relatifs à la non-extensibilité et au caractère non-configurable des propriétés sont vérifiés par rapport à la cible.</dd>
</dl>

<h2 id="Syntaxe">Syntaxe</h2>

<pre class="syntaxbox notranslate">var p = new Proxy(cible, gestionnaire);
</pre>

<h3 id="Paramètres">Paramètres</h3>

<dl>
 <dt><code>cible</code></dt>
 <dd>Une cible (qui peut être n&apos;importe quel objet, un tableau, une fonction, ou même un autre proxy) qu&apos;on souhaite envelopper dans un <code>Proxy</code>.</dd>
 <dt><code>gestionnaire</code></dt>
 <dd>Un objet dont les propriétés sont des fonctions qui définissent le comportement du proxy lorsqu&apos;on utilise une opération sur celui-ci.</dd>
</dl>

<h2 id="Méthodes">Méthodes</h2>

<dl>
 <dt><a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Proxy/revocable"><code>Proxy.revocable()</code></a></dt>
 <dd>Permet de créer un objet <code>Proxy</code> révocable.</dd>
</dl>

<h2 id="Méthodes_pour_le_gestionnaire">Méthodes pour le gestionnaire</h2>

<p>L&apos;objet utilisé comme gestionnaire regroupe les différentes fonctions « trappes » pour le <code>Proxy</code>.</p>

<div><p>Toutes ces trappes sont optionnelles. Si une trappe n&apos;a pas été définie, le comportement par défaut sera de transmettre l&apos;opération à la cible.</p>

<dl>
 <dt><a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Proxy/handler/getPrototypeOf"><code>handler.getPrototypeOf()</code></a></dt>
 <dd>Une trappe pour <a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Object/getPrototypeOf"><code>Object.getPrototypeOf</code></a>.</dd>
 <dt><a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Proxy/handler/setPrototypeOf"><code>handler.setPrototypeOf()</code></a></dt>
 <dd>Une trappe pour <a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Object/setPrototypeOf"><code>Object.setPrototypeOf</code></a>.</dd>
 <dt><a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Proxy/handler/isExtensible"><code>handler.isExtensible()</code></a></dt>
 <dd>Une trappe pour <a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Object/isExtensible"><code>Object.isExtensible</code></a>.</dd>
 <dt><a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Proxy/handler/preventExtensions"><code>handler.preventExtensions()</code></a></dt>
 <dd>Une trappe pour <a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Object/preventExtensions"><code>Object.preventExtensions</code></a>.</dd>
 <dt><a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Proxy/handler/getOwnPropertyDescriptor"><code>handler.getOwnPropertyDescriptor()</code></a></dt>
 <dd>Une trappe pour <a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Object/getOwnPropertyDescriptor"><code>Object.getOwnPropertyDescriptor</code></a>.</dd>
 <dt><a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Proxy/handler/defineProperty"><code>handler.defineProperty()</code></a></dt>
 <dd>Une trappe pour <a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Object/defineProperty"><code>Object.defineProperty</code></a>.</dd>
 <dt><a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Proxy/handler/has"><code>handler.has()</code></a></dt>
 <dd>Une trappe pour l&apos;opérateur <a href="/fr/docs/Web/JavaScript/Reference/Op%C3%A9rateurs/L_op%C3%A9rateur_in"><code>in</code></a>.</dd>
 <dt><a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Proxy/handler/get"><code>handler.get()</code></a></dt>
 <dd>Une trappe pour l&apos;accès aux valeurs des propriétés.</dd>
 <dt><a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Proxy/handler/set"><code>handler.set()</code></a></dt>
 <dd>Une trappe pour la définition des valeurs des propriétés.</dd>
 <dt><a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Proxy/handler/deleteProperty"><code>handler.deleteProperty()</code></a></dt>
 <dd>Une trappe pour l&apos;opérateur <a href="/fr/docs/Web/JavaScript/Reference/Op%C3%A9rateurs/L_op%C3%A9rateur_delete"><code>delete</code></a>.</dd>
 <dt><a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Proxy/handler/ownKeys"><code>handler.ownKeys()</code></a></dt>
 <dd>Une trappe pour <a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Object/getOwnPropertyNames"><code>Object.getOwnPropertyNames</code></a> et <a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Object/getOwnPropertySymbols"><code>Object.getOwnPropertySymbols</code></a>.</dd>
 <dt><a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Proxy/handler/apply"><code>handler.apply()</code></a></dt>
 <dd>Une trappe pour l&apos;appel d&apos;une fonction.</dd>
 <dt><a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Proxy/handler/construct"><code>handler.construct()</code></a></dt>
 <dd>Une trappe pour l&apos;opérateur <a href="/fr/docs/Web/JavaScript/Reference/Op%C3%A9rateurs/L_op%C3%A9rateur_new"><code>new</code></a>.</dd>
</dl>

<p>Certaines trappes non standards sont désormais <a href="/fr/docs/JavaScript/Reference/Annexes/Fonctionnalit%C3%A9s_d%C3%A9pr%C3%A9ci%C3%A9es#Proxy">obsolètes et ont été supprimées</a>.</p></div>

<h2 id="Exemples">Exemples</h2>

<h3 id="Exemple_simple">Exemple simple</h3>

<p>Dans ce court exemple, on renvoie le nombre <code>37</code> comme valeur par défaut lorsque la propriété nommée n&apos;est pas présente dans l&apos;objet. Pour cela, on utilise le gestionnaire correspondant à <a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Proxy/handler/get"><code>get</code></a>.</p>

<pre class="brush: js notranslate">var handler = {
    get: function(obj, prop){
        return prop in obj?
            obj[prop] :
            37;
    }
};

var p = new Proxy({}, handler);
p.a = 1;
p.b = undefined;

console.log(p.a, p.b); // 1, undefined
console.log(&apos;c&apos; in p, p.c); // false, 37
</pre>

<h3 id="Proxy_«_invisible_»">Proxy « invisible »</h3>

<p>Dans cet exemple, le proxy transfère toutes les opérations qui sont appliquées à l&apos;objet cible.</p>

<pre class="brush: js notranslate">var cible = {};
var p = new Proxy(cible, {});

p.a = 37; // L&apos;opération est transmise à la cible par le proxy

console.log(cible.a); // 37. L&apos;opération a bien été transmise
</pre>

<h3 id="Validation">Validation</h3>

<p>En utilisant un <code>Proxy</code>, il devient simple de valider les valeurs passées à un objet. Dans cet exemple, on utilise le gestionnaire correspondant à <a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Proxy/handler/set"><code>set</code></a>.</p>

<pre class="brush: js notranslate">let validateur = {
  set: function(obj, prop, valeur) {
    if (prop === &apos;âge&apos;) {
      if (!Number.isInteger(valeur)) {
        throw new TypeError(&apos;Cet âge n\&apos;est pas un entier.&apos;);
      }
      if (valeur &gt; 200) {
        throw new RangeError(&apos;Cet âge semble invalide.&apos;);
      }
    }

    // Le comportement par défaut : enregistrer la valeur
    obj[prop] = valeur;

    // On indique le succès de l&apos;opération
    return true;
  }
};

let personne = new Proxy({}, validateur);

personne.âge = 100;
console.log(personne.âge); // 100
personne.âge = &apos;jeune&apos;;    // lève une exception
personne.âge = 300;        // lève une exception
</pre>

<h3 id="Étendre_un_constructeur">Étendre un constructeur</h3>

<p>En utilisant une fonction proxy, on peut étendre un constructeur avec un nouveau constructeur. Dans cet exemple, on utilise les gestionnaires correspondants à <a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Proxy/handler/construct"><code>construct</code></a> et <a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Proxy/handler/apply"><code>apply</code></a>.</p>

<pre class="brush: js notranslate">function étendre(sup,base) {
  var descripteur = Object.getOwnPropertyDescriptor(
    base.prototype, &quot;constructor&quot;
  );
  base.prototype = Object.create(sup.prototype);
  var gestionnaire = {
    construct: function(cible, args) {
      var obj = Object.create(base.prototype);
      this.apply(cible,obj,args);
      return obj;
    },
    apply: function(cible, that, args) {
      sup.apply(that,args);
      base.apply(that,args);
    }
  };
  var proxy = new Proxy(base,gestionnaire);
  descripteur.value = proxy;
  Object.defineProperty(base.prototype, &quot;constructor&quot;, descripteur);
  return proxy;
}

var Personne = function(nom){
  this.nom = nom;
};

var Garçon = étendre(Personne, function(nom, âge) {
  this.âge = âge;
});

Garçon.prototype.genre = &quot;M&quot;;

var Pierre = new Garçon(&quot;Pierre&quot;, 13);
console.log(Pierre.genre);  // &quot;M&quot;
console.log(Pierre.nom);  // &quot;Pierre&quot;
console.log(Pierre.âge);  // 13</pre>

<h3 id="Manipuler_les_nœuds_DOM">Manipuler les nœuds DOM</h3>

<p>Parfois, on veut passer un attribut ou un nom de classe entre deux éléments différents. Dans cet exemple, on utilise le gestionnaire lié à <a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Proxy/handler/set"><code>set</code></a>.</p>

<pre class="brush: js notranslate">let vue = new Proxy({
  selected: null
},
{
  set: function(obj, prop, nouvelleValeur) {
    let ancienneValeur = obj[prop];

    if (prop === &apos;selected&apos;) {
      if (ancienneValeur) {
        ancienneValeur.setAttribute(&apos;aria-selected&apos;, &apos;false&apos;);
      }
      if (nouvelleValeur) {
        nouvelleValeur.setAttribute(&apos;aria-selected&apos;, &apos;true&apos;);
      }
    }

    // Le comportement par défaut : enregistrer la valeur
    obj[prop] = nouvelleValeur;

    // On indique le succès de l&apos;opération
    return true;
  }
});

let i1 = vue.selected = document.getElementById(&apos;item-1&apos;);
console.log(i1.getAttribute(&apos;aria-selected&apos;)); // &apos;true&apos;

let i2 = vue.selected = document.getElementById(&apos;item-2&apos;);
console.log(i1.getAttribute(&apos;aria-selected&apos;)); // &apos;false&apos;
console.log(i2.getAttribute(&apos;aria-selected&apos;)); // &apos;true&apos;
</pre>

<h3 id="Corriger_une_valeur_et_ajouter_une_propriété_supplémentaire">Corriger une valeur et ajouter une propriété supplémentaire</h3>

<p>Dans l&apos;exemple qui suit, le proxy <code>produits</code> évalue la valeur passée et la convertit en tableau si besoin. L&apos;objet supporte également la propriété supplémentaire <code>dernierNavigateur</code> à la fois comme accesseur et mutateur.</p>

<pre class="brush: js notranslate">let produits = new Proxy({
  navigateurs: [&apos;Internet Explorer&apos;, &apos;Netscape&apos;]
},
{
  get: function(obj, prop) {
    // Une propriété supplémentaire
    if (prop === &apos;dernierNavigateur&apos;) {
      return obj.navigateurs[obj.navigateurs.length - 1];
    }

    // Le comportement par défaut : renvoyer la valeur
    return obj[prop];
  },
  set: function(obj, prop, valeur) {
    // Une propriété supplémentaire
    if (prop === &apos;dernierNavigateur&apos;) {
      obj.navigateurs.push(valeur);
      return true;
    }

    // on convertit la valeur si ce n&apos;est pas un tableau
    if (typeof valeur === &apos;string&apos;) {
      valeur = [valeur];
    }

    // Le comportement par défaut : enregistrer la valeur
    obj[prop] = valeur;

    // On indique le succès de l&apos;opération
    return true;
  }
});

console.log(produits.navigateurs); // [&apos;Internet Explorer&apos;, &apos;Netscape&apos;]
produits.navigateurs = &apos;Firefox&apos;; // on passe une chaîne
console.log(produits.navigateurs); // [&apos;Firefox&apos;] &lt;- pas de problème, elle est convertie en tableau

produits.dernierNavigateur = &apos;Chrome&apos;;
console.log(produits.navigateurs); // [&apos;Firefox&apos;, &apos;Chrome&apos;]
console.log(produits.dernierNavigateur); // &apos;Chrome&apos;
</pre>

<h3 id="Trouver_un_élément_dans_un_tableau_grâce_à_sa_propriété">Trouver un élément dans un tableau grâce à sa propriété</h3>

<p>Dans cet exemple, ce proxy étend le tableau avec des fonctionnalités supplémentaires. Ici, on définit des propriétés sans utiliser <a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Object/defineProperties"><code>Object.defineProperties</code></a>. Cet exemple pourrait être adapté pour trouver la ligne d&apos;un tableau à partir d&apos;une de ces cellules (la cible serait alors <a href="/fr/docs/Web/API/HTMLTableElement.rows"><code>table.rows</code></a>).</p>

<pre class="brush: js notranslate">let produits = new Proxy([
  { nom: &apos;Firefox&apos;, type: &apos;navigateur&apos; },
  { nom: &apos;SeaMonkey&apos;, type: &apos;navigateur&apos; },
  { nom: &apos;Thunderbird&apos;, type: &apos;client mail&apos; }
],
{
  get: function(obj, prop) {
    // Le comportement par défaut : on renvoie la valeur
    // prop est généralement un entier
    if (prop in obj) {
      return obj[prop];
    }

    // On obtient le nombre de produits
    // un alias pour products.length
    if (prop === &apos;nombre&apos;) {
      return obj.length;
    }

    let résultat, types = {};

    for (let produit of obj) {
      if (produit.nom === prop) {
        résultat = produit;
      }
      if (types[produit.type]) {
        types[produit.type].push(produit);
      } else {
        types[produit.type] = [produit];
      }
    }

    // Obtenir un produit grâce à un nom
    if (résultat) {
      return résultat;
    }

    // Obtenir un produit par type
    if (prop in types) {
      return types[prop];
    }

    // Obtenir les types de produits
    if (prop === &apos;types&apos;) {
      return Object.keys(types);
    }

    return undefined;
  }
});

console.log(produits[0]); // { nom: &apos;Firefox&apos;, type: &apos;navigateur&apos; }
console.log(produits[&apos;Firefox&apos;]); // { nom: &apos;Firefox&apos;, type: &apos;navigateur&apos; }
console.log(produits[&apos;Chrome&apos;]); // undefined
console.log(produits.navigateur); // [{ nom: &apos;Firefox&apos;, type: &apos;navigateur&apos; }, { nom: &apos;SeaMonkey&apos;, type: &apos;navigateur&apos; }]
console.log(produits.types); // [&apos;navigateur&apos;, &apos;client mail&apos;]
console.log(produits.nombre); // 3
</pre>

<h3 id="Un_exemple_avec_toutes_les_trappes">Un exemple avec toutes les trappes</h3>

<p>Pour illustrer l&apos;ensemble des trappes, on tente de « proxifier » un objet non natif : l&apos;objet global <code>docCookies</code> créé grâce à <a href="/fr/docs/Web/API/Document/cookie/Simple_document.cookie_framework">cet exemple</a>.</p>

<pre class="brush: js notranslate">/*
  var docCookies = ... définir l&apos;objet &quot;docCookies&quot; grâce à
  https://developer.mozilla.org/en-US/docs/DOM/document.cookie#A_little_framework.3A_a_complete_cookies_reader.2Fwriter_with_full_unicode_support
*/

var docCookies = new Proxy(docCookies, {
  &quot;get&quot;: function (oTarget, sKey) {
    return oTarget[sKey] || oTarget.getItem(sKey) || undefined;
  },
  &quot;set&quot;: function (oTarget, sKey, vValue) {
    if (sKey in oTarget) { return false; }
    return oTarget.setItem(sKey, vValue);
  },
  &quot;deleteProperty&quot;: function (oTarget, sKey) {
    if (sKey in oTarget) { return false; }
    return oTarget.removeItem(sKey);
  },
  &quot;enumerate&quot;: function (oTarget, sKey) {
    return oTarget.keys();
  },
  &quot;ownKeys&quot;: function (oTarget, sKey) {
    return oTarget.keys();
  },
  &quot;has&quot;: function (oTarget, sKey) {
    return sKey in oTarget || oTarget.hasItem(sKey);
  },
  &quot;defineProperty&quot;: function (oTarget, sKey, oDesc) {
    if (oDesc &amp;&amp; &quot;value&quot; in oDesc) { oTarget.setItem(sKey, oDesc.value); }
    return oTarget;
  },
  &quot;getOwnPropertyDescriptor&quot;: function (oTarget, sKey) {
    var vValue = oTarget.getItem(sKey);
    return vValue ? {
      &quot;value&quot;: vValue,
      &quot;writable&quot;: true,
      &quot;enumerable&quot;: true,
      &quot;configurable&quot;: false
    } : undefined;
  },
});

/* Cookies test */

console.log(docCookies.mon_cookie1 = &quot;Première valeur&quot;);
console.log(docCookies.getItem(&quot;mon_cookie1&quot;));

docCookies.setItem(&quot;mon_cookie1&quot;, &quot;Valeur modifiée&quot;);
console.log(docCookies.mon_cookie1);</pre>

<h2 id="Spécifications">Spécifications</h2>

<table class="standard-table">
 <tbody>
  <tr>
   <th scope="col">Spécification</th>
   <th scope="col">État</th>
   <th scope="col">Commentaires</th>
  </tr>
  <tr>
   <td><a class="external" href="https://www.ecma-international.org/ecma-262/6.0/#sec-proxy-objects" hreflang="en" lang="en">ECMAScript 2015 (6th Edition, ECMA-262)<br><small lang="fr">La définition de &apos;Proxy&apos; dans cette spécification.</small></a></td>
   <td><span class="spec-Standard">Standard</span></td>
   <td>Définition initiale.</td>
  </tr>
  <tr>
   <td><a class="external" href="https://www.ecma-international.org/ecma-262/7.0/#sec-proxy-objects" hreflang="en" lang="en">ECMAScript 2016 (ECMA-262)<br><small lang="fr">La définition de &apos;Proxy&apos; dans cette spécification.</small></a></td>
   <td><span class="spec-Standard">Standard</span></td>
   <td></td>
  </tr>
  <tr>
   <td><a class="external" href="https://www.ecma-international.org/ecma-262/8.0/#sec-proxy-objects" hreflang="en" lang="en">ECMAScript 2017 (ECMA-262)<br><small lang="fr">La définition de &apos;Proxy&apos; dans cette spécification.</small></a></td>
   <td><span class="spec-Standard">Standard</span></td>
   <td></td>
  </tr>
  <tr>
   <td><a class="external" href="https://tc39.es/ecma262/#sec-proxy-objects" hreflang="en" lang="en">ECMAScript (ECMA-262)<br><small lang="fr">La définition de &apos;Proxy&apos; dans cette spécification.</small></a></td>
   <td><span class="spec-Living">Standard évolutif</span></td>
   <td></td>
  </tr>
 </tbody>
</table>

<h2 id="Compatibilité_des_navigateurs">Compatibilité des navigateurs</h2>

<div class="hidden">Ce tableau de compatibilité a été généré à partir de données structurées. Si vous souhaitez contribuer à ces données, n&apos;hésitez pas à envoyer une <em>pull request</em> sur <a href="https://github.com/mdn/browser-compat-data">https://github.com/mdn/browser-compat-data</a>.</div>

<div class="bc-data" id="bcd:javascript.builtins.Proxy"></div>

<h2 id="Voir_aussi">Voir aussi</h2>

<ul>
 <li><a href="https://www.youtube.com/watch?v=sClk6aB_CPk">“Proxies are awesome”, une présentation de Brendan Eich à JSConf</a> (en anglais) (<a href="https://www.slideshare.net/BrendanEich/metaprog-5303821">présentation</a>)</li>
 <li><a href="https://wiki.ecmascript.org/doku.php?id=harmony:proxies">La page pour la proposition ECMAScript Harmony sur Proxy</a> et <a href="https://wiki.ecmascript.org/doku.php?id=harmony:proxies_semantics">la page sur la sémantique des proxies ECMAScript Harmony</a></li>
 <li><a href="http://web.archive.org/web/20171007221059/http://soft.vub.ac.be/~tvcutsem/proxies/">Un tutoriel sur les proxies</a> (en anglais)</li>
 <li><a href="/fr/docs/JavaScript/Old_Proxy_API">L&apos;ancienne API pour les Proxy SpiderMonkey</a></li>
 <li><a href="/fr/docs/Web/JavaScript/Reference/Objets_globaux/Object/watch"><code>Object.watch()</code></a>, une fonctionnalité non-standard présente dans Gecko.</li>
</ul>

<h2 id="Notes_de_licence">Notes de licence</h2>

<p>Certains composants de cette page (texte, exemples) ont été copiés ou adaptés du <a href="https://wiki.ecmascript.org/doku.php">Wiki ECMAScript</a> dont le contenu est sous licence <a href="https://creativecommons.org/licenses/by-nc-sa/2.0/">CC 2.0 BY-NC-SA</a>.</p>
