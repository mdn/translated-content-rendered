---
title: Tu segunda extensi√≥n
slug: Mozilla/Add-ons/WebExtensions/Your_second_WebExtension
tags:
  - WebExtensions
translation_of: Mozilla/Add-ons/WebExtensions/Your_second_WebExtension
original_slug: Mozilla/Add-ons/WebExtensions/Tutorial
---
<div><section class="Quick_links" id="Quick_Links">
  <ol>
    <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions"><strong>Browser extensions</strong></a></li>
    <li class="toggle">
      <details>
        <summary>Getting started</summary>
        <ol>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/What_are_WebExtensions">What are extensions?</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Your_first_WebExtension">Your first extension</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Your_second_WebExtension">Your second extension</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Anatomy_of_a_WebExtension">Anatomy of an extension</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Examples">Example extensions</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/What_next_">What next?</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>Concepts</summary>
        <ol>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Using_the_JavaScript_APIs">Using the JavaScript APIs</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Content_scripts">Content scripts</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Match_patterns">Match patterns</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Working_with_files">Working with files</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Internationalization">Internationalization</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Security_best_practices">Security best practices</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Content_Security_Policy">Content Security Policy</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Native_messaging">Native messaging</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>User interface</summary>
        <ol>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/user_interface">User Interface</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Browser_action">Toolbar button</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Page_actions">Address bar button</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Sidebars">Sidebars</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Context_menu_items">Context menu items</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Options_pages">Options page</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Extension_pages">Extension pages</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Notifications">Notifications</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/Omnibox">Address bar suggestions</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/user_interface/devtools_panels">Developer tools panels</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>How to</summary>
        <ol>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Intercept_HTTP_requests">Intercept HTTP requests</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Modify_a_web_page">Modify a web page</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Safely_inserting_external_content_into_a_page">Insert external content</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Add_a_button_to_the_toolbar">Add a button to the toolbar</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Implement_a_settings_page">Implement a settings page</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Working_with_the_Tabs_API">Work with the Tabs API</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Bookmarks_API">Work with the Bookmarks API</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Work_with_the_Cookies_API">Work with the Cookies API</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Work_with_contextual_identities">Work with contextual identities</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Build_a_cross_browser_extension">Build a cross-browser extension</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/onboarding_upboarding_offboarding_best_practices">Onboard, upboard, and offboard users</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>Porting</summary>
        <ol>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Firefox_differentiators">Firefox differentiators</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Porting_a_Google_Chrome_extension">Porting a Google Chrome extension</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Porting_a_legacy_Firefox_add-on">Porting a legacy Firefox extension</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Comparison_with_the_Add-on_SDK">Comparison with the Add-on SDK</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Comparison_with_XUL_XPCOM_extensions">Comparison with XUL/XPCOM extensions</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Differences_between_API_implementations">Differences between API implementations</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Chrome_incompatibilities">Chrome incompatibilities</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Differences_between_desktop_and_Android">Differences between desktop and Android</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>Firefox workflow</summary>
        <ol>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Development_Tools">Developer tools</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Choose_a_Firefox_version_for_web_extension_develop">Choose a Firefox version</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/User_experience_best_practices">User Experience</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Temporary_Installation_in_Firefox">Temporary Installation in Firefox</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Debugging">Debugging</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Testing_persistent_and_restart_features">Testing persistent and restart features</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Test_permission_requests">Test permission requests</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Developing_WebExtensions_for_Firefox_for_Android">Developing for Firefox for Android</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Getting_started_with_web-ext">Getting started with web-ext</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/web-ext_command_reference">web-ext command reference</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/WebExtensions_and_the_Add-on_ID">Extensions and the Add-on ID</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Request_the_right_permissions">Request the right permissions</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Best_practices_for_updating_your_extension">Best practices for updating your extension</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>JavaScript APIs</summary>
        <ol><li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Browser_support_for_JavaScript_APIs">Browser support for JavaScript APIs</a></li><li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/API/i18n">i18n</a></li><li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/API/storage">storage</a></li><li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/API/webNavigation">webNavigation</a></li></ol>
      </details>
    </li>

    <li class="toggle">
      <details>
      <summary>Manifest keys</summary>

      </details>
    </li>
    <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Distribution_options">Distribution Options</a></li>
    <li><a href="/es/docs/Mozilla/Add-ons/Themes"><strong>Themes</strong></a></li>
    <li class="toggle">
      <details>
        <summary>Browser themes</summary>
        <ol>
          <li><a href="/es/docs/Mozilla/Add-ons/Themes/Theme_concepts">Browser theme concepts</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/Themes/Using_the_AMO_theme_generator">Using the AMO theme generator</a></li>
        </ol>
      </details>
    </li>
    <li><a href="/es/docs/Mozilla/Add-ons/Distribution"><strong>Publishing and Distribution</strong></a></li>
    <li class="toggle">
      <details>
        <summary>Publishing add-ons</summary>
        <ol>
          <li><a href="/es/docs/Mozilla/Add-ons/Distribution">Signing and distribution overview</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Package_your_extension_">Package your extension</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/Distribution/Submitting_an_add-on">Submit an add-on</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/Source_Code_Submission">Source code submission</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/Distribution/Resources_for_publishers">Resources for publishers</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/Listing">Creating an appealing listing</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/Distribution/Make_money_from_browser_extensions">Make money from browser extensions</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/Distribution/Promoting_your_extension_or_theme">Promoting your extension or theme</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/AMO/Policy/Reviews">Add-on policies</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/AMO/Policy/Agreement">Developer agreement</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/AMO/Policy/Featured">Featured add-ons</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/Distribution/Retiring_your_extension">Retiring your extension</a></li>
        </ol>
      </details>
    </li>
    <li class="toggle">
      <details>
        <summary>Distributing add-ons</summary>
        <ol>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Alternative_distribution_options/Sideloading_add-ons">For sideloading</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Alternative_distribution_options/Add-ons_for_desktop_apps">For desktop apps</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/WebExtensions/Alternative_distribution_options/Add-ons_in_the_enterprise">For an enterprise</a></li>
        </ol>
      </details>
    </li>
    <li><a href="https://discourse.mozilla.org/c/add-ons"><strong>Community and Support</strong></a></li>
    <li class="toggle">
      <details>
        <summary>Channels</summary>
        <ol>
          <li><a href="https://blog.mozilla.org/addons">Add-ons blog</a></li>
          <li><a href="https://discourse.mozilla.org/c/add-ons">Add-on forums</a></li>
          <li><a href="https://stackoverflow.com/questions/tagged/firefox-addon">Stack Overflow</a></li>
          <li><a href="/es/docs/Mozilla/Add-ons/#Contact_us">Contact us</a></li>
        </ol>
      </details>
    </li>
  </ol>
</section></div>

<p>Si ya ha visto el art√≠culo <a href="https://developer.mozilla.org/es/Add-ons/WebExtensions/Tu_primera_WebExtension">tu primer extensi√≥n</a>, ya posee una idea de como escribir una extensi√≥n. En este art√≠culo se escribir√° una extensi√≥n ligeramente m√°s compleja para demostrar un par de cosas m√°s de las APIs.</p>

<p>La extensi√≥n a√±ade un nuevo bot√≥n a la barra de herramientas de Firefox. Cuando el usuario da clic sobre el bot√≥n, mostraremos una ventana emergente que permite escoger un animal. Una vez que un animal sea escogido, reemplazaremos todas las im√°genes en la p√°gina actual con la imagen del animal seleccionado.</p>

<p>Para implementar esto, haremos lo siguiente:</p>

<ul>
 <li><strong>Definir una <a href="/es/Add-ons/WebExtensions/user_interface/Browser_action">acci√≥n del navegador</a>, que ser√° el bot√≥n a√±adido a la barra de herramientas de Firefox</strong>.<br>
  Para el bot√≥n vamos a proporcionar:
  <ul>
   <li>un icono, llamado &quot;beasts-32.png&quot;</li>
   <li>una ventana emergente para abrir cuando el bot√≥n sea presionado. La¬† ventana emergente incluye HTML, CSS y JavaScript.</li>
  </ul>
 </li>
 <li><strong>Define un √≠cono para la extensi√≥n,</strong> llamado &quot;beasts-48.png&quot;. Este ser√° mostrado en el Administrador de Complementos.</li>
 <li><strong>Escribe un script de contenido, &quot;beastify.js&quot; que ser√° inyectado dentro de las p√°ginas web.</strong><br>
  Este es el c√≥digo que modificar√° las p√°ginas web.</li>
 <li><strong>Empaqueta algunas im√°genes de animales, para reemplazar las im√°gnes de la p√°gina web</strong>.<br>
  Nosotros haremos las im√°genes &quot;recursos web accesibles&quot; para que la p√°gina web pueda referenciarlos.</li>
</ul>

<p>Tu puedes notar que la estructura general de la extensi√≥n luce como esto:</p>

<p><img alt src="https://mdn.mozillademos.org/files/13671/Untitled-1.png" style="display: block; height: 1200px; margin-left: auto; margin-right: auto; width: 860px;"></p>

<p>Esta es una extensi√≥n simple, pero muestra muchos de los principales conceptos de la API WebExtensions:</p>

<ul>
 <li>Adicionando un bot√≥n a la barra de herramientas</li>
 <li>Definiendo un panel emergente usando HTML, CSS y JavaScript</li>
 <li>Inyectando scripts de contenido dentro de las p√°ginas web</li>
 <li>Comunic√°ndonos entre los scripts de contenido y el resto de la extensi√≥n</li>
 <li>Empaquetando recursos con tu extensi√≥n que pueden ser usados por las p√°ginas web</li>
</ul>

<p>Tu puedes encontrar el¬†<a href="https://github.com/mdn/webextensions-examples/tree/master/beastify">c√≥digo fuente completo de la extensi√≥n en GitHub</a>.</p>

<p>Para escribir una extensi√≥n, necesitar√° de Firefox 45 o m√°s reciente.</p>

<h2 id="Escribiendo_la_extensi√≥n">Escribiendo la extensi√≥n</h2>

<p>Crea una carpeta nueva y navega hacia ella:</p>

<pre class="brush: bash">mkdir beastify
cd beastify</pre>

<h3 id="manifest.json">manifest.json</h3>

<p>Ahora crea un archivo llamado &quot;manifest.json&quot;, y agrega el siguiente contenido:</p>

<pre class="brush: json">{

  &quot;manifest_version&quot;: 2,
  &quot;name&quot;: &quot;Beastify&quot;,
  &quot;version&quot;: &quot;1.0&quot;,

  &quot;description&quot;: &quot;Agrega un icono de acci√≥n navegaci√≥n a la barra de herramientas. Haga clic en el bot√≥n para elegir una bestia. El contenido del cuerpo de la pesta√±a activa se sustituye por una imagen de la bestia elegida. Consulte https://developer.mozilla.org/es/Add-ons/WebExtensions/Examples#beastify&quot;,
  &quot;homepage_url&quot;: &quot;https://github.com/mdn/webextensions-examples/tree/master/beastify&quot;,
  &quot;icons&quot;: {
    &quot;48&quot;: &quot;icons/beasts-48.png&quot;
  },

  &quot;permissions&quot;: [
    &quot;activeTab&quot;
  ],

  &quot;browser_action&quot;: {
    &quot;default_icon&quot;: &quot;icons/beasts-32.png&quot;,
    &quot;default_title&quot;: &quot;Bestificar&quot;,
    &quot;default_popup&quot;: &quot;popup/choose_beast.html&quot;
  },

  &quot;web_accessible_resources&quot;: [
    &quot;beasts/frog.jpg&quot;,
    &quot;beasts/turtle.jpg&quot;,
    &quot;beasts/snake.jpg&quot;
  ]

}
</pre>

<ul>
 <li>Las tres primeras llaves: <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/manifest_version">manifest_version</a></code> , <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/name">name</a></code> , y <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/version">version</a></code> , son obligatorias y contienen los metadatos b√°sicos para la¬†extensi√≥n.</li>
 <li><code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/description">description</a></code> y <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/homepage_url">homepage_url</a></code> son opcionales, pero recomendadas: proporcionan informaci√≥n √∫til acerca de la extensi√≥n.</li>
 <li><code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/icons">icons</a></code> es opcional, pero recomedada: permite la especificaci√≥n de un √≠cono para la extensi√≥n, que ser√° mostrada en el Administrador de Complementos.</li>
 <li><code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/permissions">permissions</a></code> lista los¬†permisos que la extensi√≥n necesita. Aqu√≠ solo se pide el permiso de <a href="https://developer.mozilla.org/en-US/Add-ons/WebExtensions/manifest.json/permissions#activeTab_permission"><code>activeTab</code> permission</a>.</li>
 <li><code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/browser_action">browser_action</a></code> especifica el bot√≥n de la barra de herramientas.¬† Nosotros proveemos tres piezas de informaci√≥n aqu√≠:
  <ul>
   <li><code>default_icon</code> es obligatorio y enlaza al icono para el bot√≥n</li>
   <li><code>default_title</code> es opcional y ser√° mostrado como descripci√≥n</li>
   <li><code>default_popup</code> es usado su tu quieres una ventana emergente que ser√° mostrada cuando el usuario de clic en el bot√≥n. Lo hacemos y hemos incluido esta llave que apunta a un archivo HTML de la extensi√≥n.</li>
  </ul>
 </li>
 <li><code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/manifest.json/web_accessible_resources">web_accessible_resources</a></code> lista los archivos que queremos hacer accesibles a las p√°ginas web. Como la extensi√≥n reemplaza im√°genes en una p√°gina con im√°genes que hemos empaquetado, necesitamos hacer estas im√°genes accesibles a la p√°gina.</li>
</ul>

<p>Nota que todas las rutas dadas son relativas a manifest.json.</p>

<h3 id="El_√≠cono">El √≠cono</h3>

<p>La extensi√≥n deber√≠a tener un √≠ncono. √âste, ser√° mostrado junto a la lista de complementos en el Administrador de Complementos (Pude abrirlo introduciendo en la URL &quot;about:addons&quot;). El manifest.json promete que se posee un √≠cono para la barra de herramientas en &quot;icons/beasts-48.png&quot;.</p>

<p>Cree el directorio &quot;icons&quot; y guarde un √≠cono ah√≠ y n√≥mbrelo como &quot;beasts-48.png&quot;.¬† Puede utilizar <a href="https://github.com/mdn/webextensions-examples/blob/master/beastify/icons/beasts-48.png">uno de nuestro ejemplo</a>, el cual ha sido tomado del¬† <a href="https://www.iconfinder.com/iconsets/free-retina-icon-set">conjuto de √≠conos Aha-Soft‚Äôs Free Retina</a>, que es utilizado bajo el t√©rmino de su propia <a href="http://www.aha-soft.com/free-icons/free-retina-icon-set/">licencia</a>.</p>

<p>Si elige proporcionar su propio √≠cono, deber√≠a ser de 48x48 pixeles. Tambi√©n puede proporcionar un √≠cono de 96x96 pixeles, para pantallas de altas resoluciones y, si usted hace esto, deber√° especificarlo como la propiedad <code>96</code> del objeto <code>icons</code> en el manifest.json:</p>

<pre class="brush: json line-numbers  language-json"><code class="language-json"><span class="key token">&quot;icons&quot;:</span> <span class="punctuation token">{</span>
  <span class="key token">&quot;48&quot;:</span> <span class="string token">&quot;icons/beasts-48.png&quot;</span><span class="punctuation token">,</span>
  <span class="key token">&quot;96&quot;:</span> <span class="string token">&quot;icons/beasts-96.png&quot;</span>
<span class="punctuation token">}</span></code></pre>

<h3 id="El_bot√≥n_de_la_barra_de_herramientas">El bot√≥n de la barra de herramientas</h3>

<p>El bot√≥n de la barra de herramientas necesita un √≠cono, y nuestro manifest.json promete eso y nos gustar√≠a tener un √≠cono para la barra de herramientas en &quot;icons/beasts-32.png&quot;.</p>

<p>Guarde un √≠cono llamado &quot;beasts-32.png&quot; en el directorio &quot;icons&quot;. Tu podr√≠as usar <a href="https://github.com/mdn/webextensions-examples/blob/master/beastify/icons/beasts-32.png">uno de nuestros ejemplos</a>, los cuales son tomados desde el sitio¬†<a href="http://www.iconbeast.com/free">IconBeast Lite icon set</a> y empleados bajo sus t√©rminos de¬†<a href="http://www.iconbeast.com/faq/">licencia</a>.</p>

<p>Si tu no provees una ventana emergente, entonces el evento clic es disparado hacia tu extensi√≥n cuando el usuario de clic sobre el bot√≥n. Si provees una ventana emergente entonces el evento clic no se disparar√°, pero en cambio, se muestra la ventana emergente. Nosotros queremos una ventana emergente, as√≠ que vamos a crearla.</p>

<h3 id="La_ventana_emergente">La ventana emergente</h3>

<p>La funci√≥n de la ventana emergente es habilitada si el usuario escoge una de los tres animales.</p>

<p>Crea una nueva carpeta llamada &quot;popup&quot; bajo la carpeta ra√≠z de la extensi√≥n . Esta ser√° donde pondremos el c√≥digo para la ventana emergente. La carpeta &quot;popup&quot; contendr√° estos tres archivos:</p>

<ul>
 <li><strong><code>choose_beast.html</code></strong> define el contenido del panel</li>
 <li><strong><code>choose_beast.css</code></strong> los estilos CSS para el contenido</li>
 <li><strong><code>choose_beast.js</code></strong> maneja las opciones del usuario ejecutando un script de contenido en la pesta√±a activa</li>
</ul>

<h4 id="choose_beast.html">choose_beast.html</h4>

<p>El archivo HTML luce as√≠:</p>

<pre class="brush: html line-numbers language-html"><code class="language-html"><span class="doctype token">&lt;!DOCTYPE html&gt;</span>

<span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>html</span><span class="punctuation token">&gt;</span></span>
  <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>head</span><span class="punctuation token">&gt;</span></span>
    <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>meta</span> <span class="attr-name token">charset</span><span class="attr-value token"><span class="punctuation token">=</span><span class="punctuation token">&quot;</span>utf-8<span class="punctuation token">&quot;</span></span><span class="punctuation token">&gt;</span></span>
    <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>link</span> <span class="attr-name token">rel</span><span class="attr-value token"><span class="punctuation token">=</span><span class="punctuation token">&quot;</span>stylesheet<span class="punctuation token">&quot;</span></span> <span class="attr-name token">href</span><span class="attr-value token"><span class="punctuation token">=</span><span class="punctuation token">&quot;</span>choose_beast.css<span class="punctuation token">&quot;</span></span><span class="punctuation token">/&gt;</span></span>
  <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;/</span>head</span><span class="punctuation token">&gt;</span></span>

<span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>body</span><span class="punctuation token">&gt;</span></span>
  <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>div</span> <span class="attr-name token">id</span><span class="attr-value token"><span class="punctuation token">=</span><span class="punctuation token">&quot;</span>popup-content<span class="punctuation token">&quot;</span></span><span class="punctuation token">&gt;</span></span>
    <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>div</span> <span class="attr-name token">class</span><span class="attr-value token"><span class="punctuation token">=</span><span class="punctuation token">&quot;</span>button beast<span class="punctuation token">&quot;</span></span><span class="punctuation token">&gt;</span></span>Frog<span class="tag token"><span class="tag token"><span class="punctuation token">&lt;/</span>div</span><span class="punctuation token">&gt;</span></span>
    <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>div</span> <span class="attr-name token">class</span><span class="attr-value token"><span class="punctuation token">=</span><span class="punctuation token">&quot;</span>button beast<span class="punctuation token">&quot;</span></span><span class="punctuation token">&gt;</span></span>Turtle<span class="tag token"><span class="tag token"><span class="punctuation token">&lt;/</span>div</span><span class="punctuation token">&gt;</span></span>
    <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>div</span> <span class="attr-name token">class</span><span class="attr-value token"><span class="punctuation token">=</span><span class="punctuation token">&quot;</span>button beast<span class="punctuation token">&quot;</span></span><span class="punctuation token">&gt;</span></span>Snake<span class="tag token"><span class="tag token"><span class="punctuation token">&lt;/</span>div</span><span class="punctuation token">&gt;</span></span>
    <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>div</span> <span class="attr-name token">class</span><span class="attr-value token"><span class="punctuation token">=</span><span class="punctuation token">&quot;</span>button reset<span class="punctuation token">&quot;</span></span><span class="punctuation token">&gt;</span></span>Reset<span class="tag token"><span class="tag token"><span class="punctuation token">&lt;/</span>div</span><span class="punctuation token">&gt;</span></span>
  <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;/</span>div</span><span class="punctuation token">&gt;</span></span>
  <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>div</span> <span class="attr-name token">id</span><span class="attr-value token"><span class="punctuation token">=</span><span class="punctuation token">&quot;</span>error-content<span class="punctuation token">&quot;</span></span> <span class="attr-name token">class</span><span class="attr-value token"><span class="punctuation token">=</span><span class="punctuation token">&quot;</span>hidden<span class="punctuation token">&quot;</span></span><span class="punctuation token">&gt;</span></span>
    <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>p</span><span class="punctuation token">&gt;</span></span>Can&apos;t beastify this web page.<span class="tag token"><span class="tag token"><span class="punctuation token">&lt;/</span>p</span><span class="punctuation token">&gt;</span></span><span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>p</span><span class="punctuation token">&gt;</span></span>Try a different page.<span class="tag token"><span class="tag token"><span class="punctuation token">&lt;/</span>p</span><span class="punctuation token">&gt;</span></span>
  <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;/</span>div</span><span class="punctuation token">&gt;</span></span>
  <span class="tag token"><span class="tag token"><span class="punctuation token">&lt;</span>script</span> <span class="attr-name token">src</span><span class="attr-value token"><span class="punctuation token">=</span><span class="punctuation token">&quot;</span>choose_beast.js<span class="punctuation token">&quot;</span></span><span class="punctuation token">&gt;</span></span><span class="tag token"><span class="tag token"><span class="punctuation token">&lt;/</span>script</span><span class="punctuation token">&gt;</span></span>
<span class="tag token"><span class="tag token"><span class="punctuation token">&lt;/</span>body</span><span class="punctuation token">&gt;</span></span>

<span class="tag token"><span class="tag token"><span class="punctuation token">&lt;/</span>html</span><span class="punctuation token">&gt;</span></span></code></pre>

<p>Tenemos un elemento <code>&lt;div&gt;</code> con un ID <code>&quot;popup-content&quot;</code> que contiene un elemento para cada elecci√≥n de animal. Adem√°s, tenemos otro <code>&lt;div&gt;</code> con un ID <code>&quot;error-content&quot;</code> y una clase <code>&quot;hidden&quot;</code>, que usaremos en el case de que surja alg√∫n problema al inicializar la ventana emergente.</p>

<p>Note que referenciamos los archivos CSS y JS en el HTML como lo har√≠amos si se tratase de una p√°gina web.</p>

<h4 id="choose_beast.css">choose_beast.css</h4>

<p>El CSS ajusta el tama√±o de la ventana emergente, se asegura que las tres posibles opciones llenen el espacio y les da un poco de estilo b√°sico. Adem√°s oculta los elementos con <code>class=&quot;hidden&quot;</code>: esto significa que nuestro <code>&quot;error-content&quot;</code> <code>&lt;div&gt;</code> estar√° oculto por defecto.</p>

<pre class="brush: css line-numbers language-css"><code class="language-css"><span class="selector token">html, body</span> <span class="punctuation token">{</span>
  <span class="property token">width</span><span class="punctuation token">:</span> <span class="number token">100</span><span class="token unit">px</span><span class="punctuation token">;</span>
<span class="punctuation token">}</span>

<span class="selector token"><span class="class token">.hidden</span></span> <span class="punctuation token">{</span>
  <span class="property token">display</span><span class="punctuation token">:</span> none<span class="punctuation token">;</span>
<span class="punctuation token">}</span>

<span class="selector token"><span class="class token">.button</span></span> <span class="punctuation token">{</span>
  <span class="property token">margin</span><span class="punctuation token">:</span> <span class="number token">3</span><span class="token unit">%</span> auto<span class="punctuation token">;</span>
  <span class="property token">padding</span><span class="punctuation token">:</span> <span class="number token">4</span><span class="token unit">px</span><span class="punctuation token">;</span>
  <span class="property token">text-align</span><span class="punctuation token">:</span> center<span class="punctuation token">;</span>
  <span class="property token">font-size</span><span class="punctuation token">:</span> <span class="number token">1.5</span><span class="token unit">em</span><span class="punctuation token">;</span>
  <span class="property token">cursor</span><span class="punctuation token">:</span> pointer<span class="punctuation token">;</span>
<span class="punctuation token">}</span>

<span class="selector token"><span class="class token">.beast</span><span class="pseudo-class token">:hover</span></span> <span class="punctuation token">{</span>
  <span class="property token">background-color</span><span class="punctuation token">:</span> <span class="hexcode token">#CFF2F2</span><span class="punctuation token">;</span>
<span class="punctuation token">}</span>

<span class="selector token"><span class="class token">.beast</span></span> <span class="punctuation token">{</span>
  <span class="property token">background-color</span><span class="punctuation token">:</span> <span class="hexcode token">#E5F2F2</span><span class="punctuation token">;</span>
<span class="punctuation token">}</span>

<span class="selector token"><span class="class token">.reset</span></span> <span class="punctuation token">{</span>
  <span class="property token">background-color</span><span class="punctuation token">:</span> <span class="hexcode token">#FBFBC9</span><span class="punctuation token">;</span>
<span class="punctuation token">}</span>

<span class="selector token"><span class="class token">.reset</span><span class="pseudo-class token">:hover</span></span> <span class="punctuation token">{</span>
  <span class="property token">background-color</span><span class="punctuation token">:</span> <span class="hexcode token">#EAEA9D</span><span class="punctuation token">;</span>
<span class="punctuation token">}</span></code></pre>

<h4 id="choose_beast.js">choose_beast.js</h4>

<p>Aqu√≠ est√° el JavaScript para la ventana emergente:</p>

<pre class="brush: js line-numbers language-js"><code class="language-js"><span class="comment token">/**
 * CSS para ocultar toda la p√°gina
 * Excepto los elementos que pertenecen a la clase &quot;beastify-image&quot;.
 */</span>
<span class="keyword token">const</span> hidePage <span class="operator token">=</span> <span class="template-string token"><span class="string token">`body &gt; :not(.beastify-image) {
                    display: none;
                  }`</span></span><span class="punctuation token">;</span>

<span class="comment token">/**
 * Esucha los clicks en los botones y env√≠a el mensaje apropiado
 * al script de contenido de la p√°gina.
 */</span>
<span class="keyword token">function</span> <span class="function token">listenForClicks</span><span class="punctuation token">(</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
  document<span class="punctuation token">.</span><span class="function token">addEventListener</span><span class="punctuation token">(</span><span class="string token">&quot;click&quot;</span><span class="punctuation token">,</span> <span class="punctuation token">(</span><span class="parameter token">e</span><span class="punctuation token">)</span> <span class="operator token">=&gt;</span> <span class="punctuation token">{</span>

    <span class="comment token">/**
     * Recibe el nombre de una bestia y obtiene la URL de la imagen correspondiente.
     */</span>
    <span class="keyword token">function</span> <span class="function token">beastNameToURL</span><span class="punctuation token">(</span><span class="parameter token">beastName</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
      <span class="keyword token">switch</span> <span class="punctuation token">(</span>beastName<span class="punctuation token">)</span> <span class="punctuation token">{</span>
        <span class="keyword token">case</span> <span class="string token">&quot;Frog&quot;</span><span class="punctuation token">:</span>
          <span class="keyword token">return</span> browser<span class="punctuation token">.</span>extension<span class="punctuation token">.</span><span class="function token">getURL</span><span class="punctuation token">(</span><span class="string token">&quot;beasts/frog.jpg&quot;</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
        <span class="keyword token">case</span> <span class="string token">&quot;Snake&quot;</span><span class="punctuation token">:</span>
          <span class="keyword token">return</span> browser<span class="punctuation token">.</span>extension<span class="punctuation token">.</span><span class="function token">getURL</span><span class="punctuation token">(</span><span class="string token">&quot;beasts/snake.jpg&quot;</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
        <span class="keyword token">case</span> <span class="string token">&quot;Turtle&quot;</span><span class="punctuation token">:</span>
          <span class="keyword token">return</span> browser<span class="punctuation token">.</span>extension<span class="punctuation token">.</span><span class="function token">getURL</span><span class="punctuation token">(</span><span class="string token">&quot;beasts/turtle.jpg&quot;</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
      <span class="punctuation token">}</span>
    <span class="punctuation token">}</span>

    <span class="comment token">/**
     * Inserta dentro de la pesta√±a activa el CSS que oculta la p√°gina
     * luego toma la URL de la imagen y
     * env√≠a un mensaje &quot;beastify&quot; al script de contenido de la pesta√±a activa.
     */</span>
    <span class="keyword token">function</span> <span class="function token">beastify</span><span class="punctuation token">(</span><span class="parameter token">tabs</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
      browser<span class="punctuation token">.</span>tabs<span class="punctuation token">.</span><span class="function token">insertCSS</span><span class="punctuation token">(</span><span class="punctuation token">{</span>code<span class="punctuation token">:</span> hidePage<span class="punctuation token">}</span><span class="punctuation token">)</span><span class="punctuation token">.</span><span class="function token">then</span><span class="punctuation token">(</span><span class="punctuation token">(</span><span class="punctuation token">)</span> <span class="operator token">=&gt;</span> <span class="punctuation token">{</span>
        <span class="keyword token">let</span> url <span class="operator token">=</span> <span class="function token">beastNameToURL</span><span class="punctuation token">(</span>e<span class="punctuation token">.</span>target<span class="punctuation token">.</span>textContent<span class="punctuation token">)</span><span class="punctuation token">;</span>
        browser<span class="punctuation token">.</span>tabs<span class="punctuation token">.</span><span class="function token">sendMessage</span><span class="punctuation token">(</span>tabs<span class="punctuation token">[</span><span class="number token">0</span><span class="punctuation token">]</span><span class="punctuation token">.</span>id<span class="punctuation token">,</span> <span class="punctuation token">{</span>
          command<span class="punctuation token">:</span> <span class="string token">&quot;beastify&quot;</span><span class="punctuation token">,</span>
          beastURL<span class="punctuation token">:</span> url
        <span class="punctuation token">}</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
      <span class="punctuation token">}</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
    <span class="punctuation token">}</span>

    <span class="comment token">/**
     * Remueve el CSS que oculta la p√°gina y
     * env√≠a un mensaje de &quot;reset&quot; al script de contenido de la pesta√±a activa.
     */</span>
    <span class="keyword token">function</span> <span class="function token">reset</span><span class="punctuation token">(</span><span class="parameter token">tabs</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
      browser<span class="punctuation token">.</span>tabs<span class="punctuation token">.</span><span class="function token">removeCSS</span><span class="punctuation token">(</span><span class="punctuation token">{</span>code<span class="punctuation token">:</span> hidePage<span class="punctuation token">}</span><span class="punctuation token">)</span><span class="punctuation token">.</span><span class="function token">then</span><span class="punctuation token">(</span><span class="punctuation token">(</span><span class="punctuation token">)</span> <span class="operator token">=&gt;</span> <span class="punctuation token">{</span>
        browser<span class="punctuation token">.</span>tabs<span class="punctuation token">.</span><span class="function token">sendMessage</span><span class="punctuation token">(</span>tabs<span class="punctuation token">[</span><span class="number token">0</span><span class="punctuation token">]</span><span class="punctuation token">.</span>id<span class="punctuation token">,</span> <span class="punctuation token">{</span>
          command<span class="punctuation token">:</span> <span class="string token">&quot;reset&quot;</span><span class="punctuation token">,</span>
        <span class="punctuation token">}</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
      <span class="punctuation token">}</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
    <span class="punctuation token">}</span>

    <span class="comment token">/**
     * Imprime el error en consola.
     */</span>
    <span class="keyword token">function</span> <span class="function token">reportError</span><span class="punctuation token">(</span><span class="parameter token">error</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
      console<span class="punctuation token">.</span><span class="function token">error</span><span class="punctuation token">(</span><span class="template-string token"><span class="string token">`Could not beastify: </span><span class="interpolation token"><span class="interpolation-punctuation punctuation token">${</span>error<span class="interpolation-punctuation punctuation token">}</span></span><span class="string token">`</span></span><span class="punctuation token">)</span><span class="punctuation token">;</span>
    <span class="punctuation token">}</span>

    <span class="comment token">/**
     * Toma la pesta√±a activa y
     * llama a &quot;beastify()&quot; o &quot;reset()&quot; seg√∫n corresponda.
     */</span>
    <span class="keyword token">if</span> <span class="punctuation token">(</span>e<span class="punctuation token">.</span>target<span class="punctuation token">.</span>classList<span class="punctuation token">.</span><span class="function token">contains</span><span class="punctuation token">(</span><span class="string token">&quot;beast&quot;</span><span class="punctuation token">)</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
      browser<span class="punctuation token">.</span>tabs<span class="punctuation token">.</span><span class="function token">query</span><span class="punctuation token">(</span><span class="punctuation token">{</span>active<span class="punctuation token">:</span> <span class="boolean token">true</span><span class="punctuation token">,</span> currentWindow<span class="punctuation token">:</span> <span class="boolean token">true</span><span class="punctuation token">}</span><span class="punctuation token">)</span>
        <span class="punctuation token">.</span><span class="function token">then</span><span class="punctuation token">(</span>beastify<span class="punctuation token">)</span>
        <span class="punctuation token">.</span><span class="function token">catch</span><span class="punctuation token">(</span>reportError<span class="punctuation token">)</span><span class="punctuation token">;</span>
    <span class="punctuation token">}</span>
    <span class="keyword token">else</span> <span class="keyword token">if</span> <span class="punctuation token">(</span>e<span class="punctuation token">.</span>target<span class="punctuation token">.</span>classList<span class="punctuation token">.</span><span class="function token">contains</span><span class="punctuation token">(</span><span class="string token">&quot;reset&quot;</span><span class="punctuation token">)</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
      browser<span class="punctuation token">.</span>tabs<span class="punctuation token">.</span><span class="function token">query</span><span class="punctuation token">(</span><span class="punctuation token">{</span>active<span class="punctuation token">:</span> <span class="boolean token">true</span><span class="punctuation token">,</span> currentWindow<span class="punctuation token">:</span> <span class="boolean token">true</span><span class="punctuation token">}</span><span class="punctuation token">)</span>
        <span class="punctuation token">.</span><span class="function token">then</span><span class="punctuation token">(</span>reset<span class="punctuation token">)</span>
        <span class="punctuation token">.</span><span class="function token">catch</span><span class="punctuation token">(</span>reportError<span class="punctuation token">)</span><span class="punctuation token">;</span>
    <span class="punctuation token">}</span>
  <span class="punctuation token">}</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
<span class="punctuation token">}</span>

<span class="comment token">/**
 * Si hubo alg√∫n error al ejecutar el script,
 * Despliega un popup con el mensaje de error y oculta la UI normal.
 */</span>
<span class="keyword token">function</span> <span class="function token">reportExecuteScriptError</span><span class="punctuation token">(</span><span class="parameter token">error</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
  document<span class="punctuation token">.</span><span class="function token">querySelector</span><span class="punctuation token">(</span><span class="string token">&quot;#popup-content&quot;</span><span class="punctuation token">)</span><span class="punctuation token">.</span>classList<span class="punctuation token">.</span><span class="function token">add</span><span class="punctuation token">(</span><span class="string token">&quot;hidden&quot;</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
  document<span class="punctuation token">.</span><span class="function token">querySelector</span><span class="punctuation token">(</span><span class="string token">&quot;#error-content&quot;</span><span class="punctuation token">)</span><span class="punctuation token">.</span>classList<span class="punctuation token">.</span><span class="function token">remove</span><span class="punctuation token">(</span><span class="string token">&quot;hidden&quot;</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
  console<span class="punctuation token">.</span><span class="function token">error</span><span class="punctuation token">(</span><span class="template-string token"><span class="string token">`Failed to execute beastify content script: </span><span class="interpolation token"><span class="interpolation-punctuation punctuation token">${</span>error<span class="punctuation token">.</span>message<span class="interpolation-punctuation punctuation token">}</span></span><span class="string token">`</span></span><span class="punctuation token">)</span><span class="punctuation token">;</span>
<span class="punctuation token">}</span>

<span class="comment token">/**
 * Cuando se carga la ventana emergente, inyecta el script de contenido en la pesta√±a activa,
 * y agrega un manejador de eventos.
 * Si no es posible inyectar el script, se ocupa de manejar el error.
 */</span>
browser<span class="punctuation token">.</span>tabs<span class="punctuation token">.</span><span class="function token">executeScript</span><span class="punctuation token">(</span><span class="punctuation token">{</span>file<span class="punctuation token">:</span> <span class="string token">&quot;/content_scripts/beastify.js&quot;</span><span class="punctuation token">}</span><span class="punctuation token">)</span>
<span class="punctuation token">.</span><span class="function token">then</span><span class="punctuation token">(</span>listenForClicks<span class="punctuation token">)</span>
<span class="punctuation token">.</span><span class="function token">catch</span><span class="punctuation token">(</span>reportExecuteScriptError<span class="punctuation token">)</span><span class="punctuation token">;</span></code></pre>

<p>Empecemos por la linea 96. La ventana emergente ejecuta un script de contenido en la pesta√±a activa tan pronto como se termina de cargar, usando la API <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/executeScript">browser.tabs.executeScript()</a></code>. Si la ejecuci√≥n del script de contenido es exitosa, este quedar√° cargado en la p√°gina hasta que sea cerrada la pesta√±a o hasta que el usuario navegue hacia una p√°gina distinta.</p>

<div class="note notecard">
<p>Un motivo com√∫n por el cual el llamado a <code>browser.tabs.executeScript()</code> puede fallar, es porque no es posible ejecutar scripts de contenido en todas las p√°ginas, por ejemplo, en p√°ginas de navegador privilegiadas como about:debugging, o p√°ginas del dominio <a href="https://addons.mozilla.org/">addons.mozilla.org</a>, no es posible hacerlo.</p>
</div>

<p>Si la ejecuci√≥n falla, <code>reportExecuteScriptError()</code> ocultar√° el <code>&lt;div&gt;</code> <code>&quot;popup-content&quot;</code>, mostrar√° el <code>&lt;div&gt;</code> <code>&quot;error-content&quot;</code>, y reportar√° el error en la consola.</p>

<p>Si la ejecuci√≥n del script de contenido es exitosa, se llamar√° a <code>listenForClicks()</code>, que atiende los eventos que se generan al cliquear en la ventana emergente.</p>

<ul>
 <li>Si el clic se produjo en el bot√≥n con <code>class=&quot;beast&quot;</code>, se llama a <code>beastify()</code>.</li>
 <li>Si el clic se produjo en el bot√≥n con <code>class=&quot;reset&quot;</code>, se llama a¬† <code>reset()</code>.</li>
</ul>

<p>La funci√≥n <code>beastify()</code> hace tres cosas:</p>

<ul>
 <li>map the button clicked to a URL pointing to an image of a particular beast</li>
 <li>Oculta todo el contenido de la p√°gina al insertar CSS con la API <code><a href="https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API/tabs/insertCSS">browser.tabs.insertCSS()</a></code></li>
 <li>Env√≠a un mensaje &quot;beastify&quot; al script de contenido usando la API <code><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Add-ons/WebExtensions/API/tabs/sendMessage">browser.tabs.sendMessage()</a></code>, solicit√°ndole &quot;bestificar&quot; la p√°gina, y envi√°ndole la URL de la imagen.</li>
</ul>

<p>La funci√≥n <code>reset()</code> deshace lo hecho por <code>beastify()</code>:</p>

<ul>
 <li>Remueve el CSS que agreg√≥, usando la API <code><a href="https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API/tabs/removeCSS">browser.tabs.removeCSS()</a></code></li>
 <li>Env√≠a un mensaje de &quot;reset&quot; al script de contenido, solicit√°ndole que resetee la p√°gina</li>
</ul>

<h3 id="El_script_de_contenido">El script de contenido</h3>

<p>Crea una carpeta nueva bajo la ra√≠z del complemento llamada &quot;content_scripts&quot; y crea un nuevo archivo en ella llamado &quot;beastify.js&quot;, con el contenido siguiente:</p>

<pre class="brush: js line-numbers language-js"><code class="language-js"><span class="punctuation token">(</span><span class="keyword token">function</span><span class="punctuation token">(</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
  <span class="comment token">/**
   * Revisa e inicializa una variable de guardia.
   * Si este script de contenido es insertado m√°s de una vez
   * en la misma p√°gina, dejar√° de ejecutarse.
   */</span>
  <span class="keyword token">if</span> <span class="punctuation token">(</span>window<span class="punctuation token">.</span>hasRun<span class="punctuation token">)</span> <span class="punctuation token">{</span>
    <span class="keyword token">return</span><span class="punctuation token">;</span>
  <span class="punctuation token">}</span>
  window<span class="punctuation token">.</span>hasRun <span class="operator token">=</span> <span class="boolean token">true</span><span class="punctuation token">;</span>

<span class="comment token">/**
* Recibe la URL de la imagen, remueve las que se hayan agregado antes,
* crea un nodo IMG que apunt hacia la imagen
* e inserta ese nodo en el documento.
*/</span>
  <span class="keyword token">function</span> <span class="function token">insertBeast</span><span class="punctuation token">(</span><span class="parameter token">beastURL</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
    <span class="function token">removeExistingBeasts</span><span class="punctuation token">(</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
    <span class="keyword token">let</span> beastImage <span class="operator token">=</span> document<span class="punctuation token">.</span><span class="function token">createElement</span><span class="punctuation token">(</span><span class="string token">&quot;img&quot;</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
    beastImage<span class="punctuation token">.</span><span class="function token">setAttribute</span><span class="punctuation token">(</span><span class="string token">&quot;src&quot;</span><span class="punctuation token">,</span> beastURL<span class="punctuation token">)</span><span class="punctuation token">;</span>
    beastImage<span class="punctuation token">.</span>style<span class="punctuation token">.</span>height <span class="operator token">=</span> <span class="string token">&quot;100vh&quot;</span><span class="punctuation token">;</span>
    beastImage<span class="punctuation token">.</span>className <span class="operator token">=</span> <span class="string token">&quot;beastify-image&quot;</span><span class="punctuation token">;</span>
    document<span class="punctuation token">.</span>body<span class="punctuation token">.</span><span class="function token">appendChild</span><span class="punctuation token">(</span>beastImage<span class="punctuation token">)</span><span class="punctuation token">;</span>
  <span class="punctuation token">}</span>

  <span class="comment token">/**
   * Remueve todas las bestias de la p√°gina.
   */</span>
  <span class="keyword token">function</span> <span class="function token">removeExistingBeasts</span><span class="punctuation token">(</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
    <span class="keyword token">let</span> existingBeasts <span class="operator token">=</span> document<span class="punctuation token">.</span><span class="function token">querySelectorAll</span><span class="punctuation token">(</span><span class="string token">&quot;.beastify-image&quot;</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
    <span class="keyword token">for</span> <span class="punctuation token">(</span><span class="keyword token">let</span> beast <span class="keyword token">of</span> existingBeasts<span class="punctuation token">)</span> <span class="punctuation token">{</span>
      beast<span class="punctuation token">.</span><span class="function token">remove</span><span class="punctuation token">(</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
    <span class="punctuation token">}</span>
  <span class="punctuation token">}</span>

  <span class="comment token">/**
   * Atiende mensajes del script de segundo plano.
   * Llama a &quot;beastify()&quot; o &quot;reset()&quot;.
  */</span>
  browser<span class="punctuation token">.</span>runtime<span class="punctuation token">.</span>onMessage<span class="punctuation token">.</span><span class="function token">addListener</span><span class="punctuation token">(</span><span class="punctuation token">(</span><span class="parameter token">message</span><span class="punctuation token">)</span> <span class="operator token">=&gt;</span> <span class="punctuation token">{</span>
    <span class="keyword token">if</span> <span class="punctuation token">(</span>message<span class="punctuation token">.</span>command <span class="operator token">===</span> <span class="string token">&quot;beastify&quot;</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
      <span class="function token">insertBeast</span><span class="punctuation token">(</span>message<span class="punctuation token">.</span>beastURL<span class="punctuation token">)</span><span class="punctuation token">;</span>
    <span class="punctuation token">}</span> <span class="keyword token">else</span> <span class="keyword token">if</span> <span class="punctuation token">(</span>message<span class="punctuation token">.</span>command <span class="operator token">===</span> <span class="string token">&quot;reset&quot;</span><span class="punctuation token">)</span> <span class="punctuation token">{</span>
      <span class="function token">removeExistingBeasts</span><span class="punctuation token">(</span><span class="punctuation token">)</span><span class="punctuation token">;</span>
    <span class="punctuation token">}</span>
  <span class="punctuation token">}</span><span class="punctuation token">)</span><span class="punctuation token">;</span>

<span class="punctuation token">}</span><span class="punctuation token">)</span><span class="punctuation token">(</span><span class="punctuation token">)</span><span class="punctuation token">;</span></code></pre>

<p>Lo primero que hace el script de contenido es revisar la variable global <code>window.hasRun</code>: si est√° inicializada termina su ejecuci√≥n, sino, la inicializa y contin√∫a. La raz√≥n por la que hacemos esto es porque cada vez que el usuario abre la ventana emergente, se vuelve a ejecutar el script de contenido en la pesta√±a activa, por lo que podr√≠amos tener m√∫ltiples instancias del script ejecutandose en una sola pesta√±a. Si esto sucede, necesitamos asegurarnos de que sea s√≥lo la primera instancia la que vaya a realizar cambios.</p>

<p>Luego, en la linea 40, donde el script de contenido atiende mensajes provenientes de la ventana emergente (usando la API <code><a href="https://developer.mozilla.org/en-US/Add-ons/WebExtensions/API/runtime/onMessage">browser.runtime.onMessage</a></code>), vemos que √©sta puede enviar dos mensajes diferentes: &quot;beastify&quot; y &quot;reset&quot;.</p>

<ul>
 <li>si el mensaje es &quot;beastify&quot;, esperamos que contenga la URL de la imagen. Removemos el contenido que ha sido agregado por el anterior llamado a &quot;beastify&quot;, y luego construimos y¬† a√±adimos un elemento <code><a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/img">&lt;img&gt;</a></code> cuyo atributo <code>src</code> contiene la URL de la imagen.</li>
 <li>si el mensaje es &quot;reset&quot;, simplemente removemos cualquier imagen que haya sido agregada antes.</li>
</ul>

<h3 id="Las_bestias">Las bestias</h3>

<p>Finalmente, necesitamos incluir las im√°genes de los animales.</p>

<p>Crea una carpeta nueva llamada &quot;beasts&quot;, y adiciona tres im√°genes en ella, con su nombre apropiado. Tu puedes obtener estas im√°genes desde el¬†<a href="https://github.com/mdn/webextensions-examples/tree/master/beastify/beasts">repositorio en GitHub</a>, o desde aqu√≠:</p>

<p><img alt src="https://mdn.mozillademos.org/files/11459/frog.jpg" style="display: inline-block; height: 200px; margin: 20px; width: 200px;"><img alt src="https://mdn.mozillademos.org/files/11461/snake.jpg" style="display: inline-block; height: 200px; margin: 20px; width: 200px;"><img alt src="https://mdn.mozillademos.org/files/11463/turtle.jpg" style="display: inline-block; height: 200px; margin: 20px; width: 200px;"></p>

<h2 id="Prob√°ndolo">Prob√°ndolo</h2>

<p>Primero, comprueba nuevamente que tienes todos los archivos necesarios en el lugar adecuado:</p>

<pre class="line-numbers  language-html"><code class="language-html">beastify/

    beasts/
        frog.jpg
        snake.jpg
        turtle.jpg

    content_scripts/
        beastify.js

    icons/
        beasts-32.png
        beasts-48.png

    popup/
        choose_beast.css
        choose_beast.html
        choose_beast.js

    manifest.json</code></pre>

<p>Comenzando con Firefox 45, pueden instalar temporalmente una extensi√≥n desde el disco.</p>

<p>Abre &quot;about:debugging&quot; en Firefox, de clic en &quot;Cargar complemento temporalmente&quot;, y seleccione el archivo manifest.json. Entonces, deber√≠a de ver el √≠cono de la extensi√≥n aparecer en la barra de herramientas de Firefox:</p>

<p></p><div class="intrinsic-wrapper"><div class="intrinsic-container "><iframe src="https://www.youtube.com/embed/sAM78GU4P34?rel=0&amp;html5=1"></iframe></div></div><p></p>

<p>Abra una p√°gina web, luego haga clic sobre el √≠cono, seleccione una bestia, y vea c√≥mo cambia la p√°gina web:</p>

<p></p><div class="intrinsic-wrapper"><div class="intrinsic-container "><iframe src="https://www.youtube.com/embed/YMQXyAQSiE8?rel=0&amp;html5=1"></iframe></div></div><p></p>

<h2 id="Desarrollo_desde_la_l√≠nea_de_comandos">Desarrollo desde la l√≠nea de comandos</h2>

<div id="gt-res-content">
<div class="trans-verified-button-small" dir="ltr" id="gt-res-dir-ctr">
<div id="tts_button">¬†</div>

<p><span id="result_box" lang="es"><span>Puede automatizar el paso de instalaci√≥n temporal mediante la herramienta <a href="https://developer.mozilla.org/es/Add-ons/WebExtensions/Getting_started_with_web-ext">web-ext</a>.</span> <span>Pruebe esto</span></span>:</p>
</div>
</div>

<pre class="brush: bash line-numbers  language-bash"><code class="language-bash">cd beastify
web-ext run</code></pre>

<p>¬†</p>
