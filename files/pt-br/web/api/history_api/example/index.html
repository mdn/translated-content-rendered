---
title: Exemplo de navegação Ajax
slug: Web/API/History_API/Example
tags:
  - Exemplo navegação ajax
translation_of: Web/API/History_API/Example
original_slug: Web/API/History_API/Exemplo
---
<p>Esse é um exemplo de um web site em AJAX web site composto por apenas três páginas (<em>first_page.php</em>, <em>second_page.php</em> e <em>third_page.php</em>). Para ver como funciona, crie os arquivos a seguir (ou <em>git clone</em> <a href="https://github.com/giabao/mdn-ajax-nav-example" title="/en-US/docs/">https://github.com/giabao/mdn-ajax-nav-example.git</a> ):</p>

<div class="note notecard" id="const_compatibility"><strong>Nota:</strong> Para integrar completamente os elementos <a href="/pt-BR/docs/Web/HTML/Element/form" title="O elemento HTML &lt;form&gt; representa uma seção de um documento que contém controles interativos que permitem ao usuário submeter informação a um determinado servidor web."><code>&lt;form&gt;</code></a> com esse <em>mecanismo</em>, porfavor dê uma olhada no parágrafo <a href="/pt-BR/docs/Web/API/XMLHttpRequest/Using_XMLHttpRequest#Submitting_forms_and_uploading_files">Enviando formulários e enviando arquivos</a>.</div>

<p><strong>first_page.php</strong>:</p>

<div style="height: 400px; margin-bottom: 12px; overflow: auto;">
<pre class="brush: php">&lt;?php
    $page_title = &quot;Primeira página&quot;;

    $as_json = false;
    if (isset($_GET[&quot;view_as&quot;]) &amp;&amp; $_GET[&quot;view_as&quot;] == &quot;json&quot;) {
        $as_json = true;
        ob_start();
    } else {
?&gt;
&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;?php
        include &quot;include/header.php&quot;;
        echo &quot;&lt;title&gt;&quot; . $page_title . &quot;&lt;/title&gt;&quot;;
?&gt;
&lt;/head&gt;

&lt;body&gt;

&lt;?php include &quot;include/before_content.php&quot;; ?&gt;

&lt;p&gt;Esse parágrafo só é mostrado quando a navegação começa em &lt;strong&gt;first_page.php&lt;/strong&gt;.&lt;/p&gt;

&lt;div id=&quot;ajax-content&quot;&gt;
&lt;?php } ?&gt;

    &lt;p&gt;Esse é o conteúdo de &lt;strong&gt;first_page.php&lt;/strong&gt;.&lt;/p&gt;

&lt;?php
    if ($as_json) {
        echo json_encode(array(&quot;page&quot; =&gt; $page_title, &quot;content&quot; =&gt; ob_get_clean()));
    } else {
?&gt;
&lt;/div&gt;

&lt;p&gt;Esse parágrafo só é mostrado quando a navegação começa em &lt;strong&gt;first_page.php&lt;/strong&gt;.&lt;/p&gt;

&lt;?php
        include &quot;include/after_content.php&quot;;
        echo &quot;&lt;/body&gt;\n&lt;/html&gt;&quot;;
    }
?&gt;
</pre>
</div>

<p><strong>second_page.php</strong>:</p>

<div style="height: 400px; margin-bottom: 12px; overflow: auto;">
<pre class="brush: php">&lt;?php
    $page_title = &quot;Segunda página&quot;;

    $as_json = false;
    if (isset($_GET[&quot;view_as&quot;]) &amp;&amp; $_GET[&quot;view_as&quot;] == &quot;json&quot;) {
        $as_json = true;
        ob_start();
    } else {
?&gt;
&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;?php
        include &quot;include/header.php&quot;;
        echo &quot;&lt;title&gt;&quot; . $page_title . &quot;&lt;/title&gt;&quot;;
?&gt;
&lt;/head&gt;

&lt;body&gt;

&lt;?php include &quot;include/before_content.php&quot;; ?&gt;

&lt;p&gt;Esse parágrafo só é mostrado quando a navegação começa em &lt;strong&gt;second_page.php&lt;/strong&gt;.&lt;/p&gt;

&lt;div id=&quot;ajax-content&quot;&gt;
&lt;?php } ?&gt;

    &lt;p&gt;Esse é o conteúdo de &lt;strong&gt;second_page.php&lt;/strong&gt;.&lt;/p&gt;

&lt;?php
    if ($as_json) {
        echo json_encode(array(&quot;page&quot; =&gt; $page_title, &quot;content&quot; =&gt; ob_get_clean()));
    } else {
?&gt;
&lt;/div&gt;

&lt;p&gt;Esse parágrafo só é mostrado quando a navegação começa em &lt;strong&gt;second_page.php&lt;/strong&gt;.&lt;/p&gt;

&lt;?php
        include &quot;include/after_content.php&quot;;
        echo &quot;&lt;/body&gt;\n&lt;/html&gt;&quot;;
    }
?&gt;
</pre>
</div>

<p><strong>third_page.php</strong>:</p>

<div style="height: 400px; margin-bottom: 12px; overflow: auto;">
<pre class="brush: php">&lt;?php
    $page_title = &quot;Terceira página&quot;;
    $page_content = &quot;&lt;p&gt;Esse é o conteúdo de &lt;strong&gt;third_page.php&lt;/strong&gt;. This content is stored into a php variable.&lt;/p&gt;&quot;;

    if (isset($_GET[&quot;view_as&quot;]) &amp;&amp; $_GET[&quot;view_as&quot;] == &quot;json&quot;) {
        echo json_encode(array(&quot;page&quot; =&gt; $page_title, &quot;content&quot; =&gt; $page_content));
    } else {
?&gt;
&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;?php
        include &quot;include/header.php&quot;;
        echo &quot;&lt;title&gt;&quot; . $page_title . &quot;&lt;/title&gt;&quot;;
?&gt;
&lt;/head&gt;

&lt;body&gt;

&lt;?php include &quot;include/before_content.php&quot;; ?&gt;

&lt;p&gt;Esse parágrafo só é mostrado quando a navegação começa em &lt;strong&gt;third_page.php&lt;/strong&gt;.&lt;/p&gt;

&lt;div id=&quot;ajax-content&quot;&gt;
&lt;?php echo $page_content; ?&gt;
&lt;/div&gt;

&lt;p&gt;Esse parágrafo só é mostrado quando a navegação começa em &lt;strong&gt;third_page.php&lt;/strong&gt;.&lt;/p&gt;

&lt;?php
        include &quot;include/after_content.php&quot;;
        echo &quot;&lt;/body&gt;\n&lt;/html&gt;&quot;;
    }
?&gt;
</pre>
</div>

<p><strong>css/style.css</strong>:</p>

<pre class="brush: css">#ajax-loader {
    position: fixed;
    display: table;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
}

#ajax-loader &gt; div {
    display: table-cell;
    width: 100%;
    height: 100%;
    vertical-align: middle;
    text-align: center;
    background-color: #000000;
    opacity: 0.65;
}
</pre>

<p><strong>include/after_content.php</strong>:</p>

<pre class="brush: php">&lt;p&gt;Esse é o rodapé. Ele é compartilhado entre todas as páginas ajax.&lt;/p&gt;
</pre>

<p><strong>include/before_content.php</strong>:</p>

<pre class="brush: php">&lt;p&gt;
[ &lt;a class=&quot;ajax-nav&quot; href=&quot;first_page.php&quot;&gt;Primeiro exemplo&lt;/a&gt;
| &lt;a class=&quot;ajax-nav&quot; href=&quot;second_page.php&quot;&gt;Segundo exemplo&lt;/a&gt;
| &lt;a class=&quot;ajax-nav&quot; href=&quot;third_page.php&quot;&gt;Terceiro exemplo&lt;/a&gt;
| &lt;a class=&quot;ajax-nav&quot; href=&quot;unexisting.php&quot;&gt;Página inexistente&lt;/a&gt; ]
&lt;/p&gt;

</pre>

<p><strong>include/header.php</strong>:</p>

<pre class="brush: php">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;
&lt;script type=&quot;text/javascript&quot; src=&quot;js/ajax_nav.js&quot;&gt;&lt;/script&gt;
&lt;link rel=&quot;stylesheet&quot; href=&quot;css/style.css&quot; /&gt;
</pre>

<p><strong>js/ajax_nav.js</strong>:</p>

<p>(antes de implementar em um ambiente de trabalho, <strong>porfavor leia <a href="#const_compatibility" title="Note about *const* compatibility">a nota sobre a compatibilidade de declaração de const</a></strong>)</p>

<div style="height: 400px; margin-bottom: 12px; overflow: auto;">
<pre class="brush: js">&quot;use strict&quot;;

const ajaxRequest = new (function () {

    function closeReq () {
        oLoadingBox.parentNode &amp;&amp; document.body.removeChild(oLoadingBox);
        bIsLoading = false;
    }

    function abortReq () {
        if (!bIsLoading) { return; }
        oReq.abort();
        closeReq();
    }

    function ajaxError () {
        alert(&quot;Unknown error.&quot;);
    }

    function ajaxLoad () {
        var vMsg, nStatus = this.status;
        switch (nStatus) {
            case 200:
                vMsg = JSON.parse(this.responseText);
                document.title = oPageInfo.title = vMsg.page;
                document.getElementById(sTargetId).innerHTML = vMsg.content;
                if (bUpdateURL) {
                    history.pushState(oPageInfo, oPageInfo.title, oPageInfo.url);
                    bUpdateURL = false;
                }
                break;
            default:
                vMsg = nStatus + &quot;: &quot; + (oHTTPStatus[nStatus] || &quot;Unknown&quot;);
                switch (Math.floor(nStatus / 100)) {
                    /*
                    case 1:
                        // Informational 1xx
                        console.log(&quot;Information code &quot; + vMsg);
                        break;
                    case 2:
                        // Successful 2xx
                        console.log(&quot;Successful code &quot; + vMsg);
                        break;
                    case 3:
                        // Redirection 3xx
                        console.log(&quot;Redirection code &quot; + vMsg);
                        break;
                    */
                    case 4:
                        /* Client Error 4xx */
                        alert(&quot;Client Error #&quot; + vMsg);
                        break;
                    case 5:
                        /* Server Error 5xx */
                        alert(&quot;Server Error #&quot; + vMsg);
                        break;
                    default:
                        /* Unknown status */
                        ajaxError();
                }
        }
        closeReq();
    }

    function filterURL (sURL, sViewMode) {
        return sURL.replace(rSearch, &quot;&quot;) + (&quot;?&quot; + sURL.replace(rHost, &quot;&amp;&quot;).replace(rView, sViewMode ? &quot;&amp;&quot; + sViewKey + &quot;=&quot; + sViewMode : &quot;&quot;).slice(1)).replace(rEndQstMark, &quot;&quot;);
    }

    function getPage (sPage) {
        if (bIsLoading) { return; }
        oReq = new XMLHttpRequest();
        bIsLoading = true;
        oReq.onload = ajaxLoad;
        oReq.onerror = ajaxError;
        if (sPage) { oPageInfo.url = filterURL(sPage, null); }
        oReq.open(&quot;get&quot;, filterURL(oPageInfo.url, &quot;json&quot;), true);
        oReq.send();
        oLoadingBox.parentNode || document.body.appendChild(oLoadingBox);
    }

    function requestPage (sURL) {
        if (history.pushState) {
            bUpdateURL = true;
            getPage(sURL);
        } else {
            /* Ajax navigation is not supported */
            location.assign(sURL);
        }
    }

    function processLink () {
        if (this.className === sAjaxClass) {
            requestPage(this.href);
            return false;
        }
        return true;
    }

    function init () {
        oPageInfo.title = document.title;
        history.replaceState(oPageInfo, oPageInfo.title, oPageInfo.url);
        for (var oLink, nIdx = 0, nLen = document.links.length; nIdx &lt; nLen; document.links[nIdx++].onclick = processLink);
    }

    const

        /* customizable constants */
        sTargetId = &quot;ajax-content&quot;, sViewKey = &quot;view_as&quot;, sAjaxClass = &quot;ajax-nav&quot;,

        /* not customizable constants */
        rSearch = /\?.*$/, rHost = /^[^\?]*\?*&amp;*/, rView = new RegExp(&quot;&amp;&quot; + sViewKey + &quot;\\=[^&amp;]*|&amp;*$&quot;, &quot;i&quot;), rEndQstMark = /\?$/,
        oLoadingBox = document.createElement(&quot;div&quot;), oCover = document.createElement(&quot;div&quot;), oLoadingImg = new Image(),
        oPageInfo = {
            title: null,
            url: location.href
        }, oHTTPStatus = /* http://www.iana.org/assignments/http-status-codes/http-status-codes.xml */ {
            100: &quot;Continue&quot;,
            101: &quot;Switching Protocols&quot;,
            102: &quot;Processing&quot;,
            200: &quot;OK&quot;,
            201: &quot;Created&quot;,
            202: &quot;Accepted&quot;,
            203: &quot;Non-Authoritative Information&quot;,
            204: &quot;No Content&quot;,
            205: &quot;Reset Content&quot;,
            206: &quot;Partial Content&quot;,
            207: &quot;Multi-Status&quot;,
            208: &quot;Already Reported&quot;,
            226: &quot;IM Used&quot;,
            300: &quot;Multiple Choices&quot;,
            301: &quot;Moved Permanently&quot;,
            302: &quot;Found&quot;,
            303: &quot;See Other&quot;,
            304: &quot;Not Modified&quot;,
            305: &quot;Use Proxy&quot;,
            306: &quot;Reserved&quot;,
            307: &quot;Temporary Redirect&quot;,
            308: &quot;Permanent Redirect&quot;,
            400: &quot;Bad Request&quot;,
            401: &quot;Unauthorized&quot;,
            402: &quot;Payment Required&quot;,
            403: &quot;Forbidden&quot;,
            404: &quot;Not Found&quot;,
            405: &quot;Method Not Allowed&quot;,
            406: &quot;Not Acceptable&quot;,
            407: &quot;Proxy Authentication Required&quot;,
            408: &quot;Request Timeout&quot;,
            409: &quot;Conflict&quot;,
            410: &quot;Gone&quot;,
            411: &quot;Length Required&quot;,
            412: &quot;Precondition Failed&quot;,
            413: &quot;Request Entity Too Large&quot;,
            414: &quot;Request-URI Too Long&quot;,
            415: &quot;Unsupported Media Type&quot;,
            416: &quot;Requested Range Not Satisfiable&quot;,
            417: &quot;Expectation Failed&quot;,
            422: &quot;Unprocessable Entity&quot;,
            423: &quot;Locked&quot;,
            424: &quot;Failed Dependency&quot;,
            425: &quot;Unassigned&quot;,
            426: &quot;Upgrade Required&quot;,
            427: &quot;Unassigned&quot;,
            428: &quot;Precondition Required&quot;,
            429: &quot;Too Many Requests&quot;,
            430: &quot;Unassigned&quot;,
            431: &quot;Request Header Fields Too Large&quot;,
            500: &quot;Internal Server Error&quot;,
            501: &quot;Not Implemented&quot;,
            502: &quot;Bad Gateway&quot;,
            503: &quot;Service Unavailable&quot;,
            504: &quot;Gateway Timeout&quot;,
            505: &quot;HTTP Version Not Supported&quot;,
            506: &quot;Variant Also Negotiates (Experimental)&quot;,
            507: &quot;Insufficient Storage&quot;,
            508: &quot;Loop Detected&quot;,
            509: &quot;Unassigned&quot;,
            510: &quot;Not Extended&quot;,
            511: &quot;Network Authentication Required&quot;
        };

    var

        oReq, bIsLoading = false, bUpdateURL = false;

    oLoadingBox.id = &quot;ajax-loader&quot;;
    oCover.onclick = abortReq;
    oLoadingImg.src = &quot;data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA==&quot;;
    oCover.appendChild(oLoadingImg);
    oLoadingBox.appendChild(oCover);

    onpopstate = function (oEvent) {
        bUpdateURL = false;
        oPageInfo.title = oEvent.state.title;
        oPageInfo.url = oEvent.state.url;
        getPage();
    };

    window.addEventListener ? addEventListener(&quot;load&quot;, init, false) : window.attachEvent ? attachEvent(&quot;onload&quot;, init) : (onload = init);

    // Public methods

    this.open = requestPage;
    this.stop = abortReq;
    this.rebuildLinks = init;

})();
</pre>
</div>

<div class="note notecard" id="const_compatibility"><strong>Nota:</strong> A atual implementação de <a href="/en/JavaScript/Reference/Statements/const" title="en/JavaScript/Reference/Statements/const"><code>const</code></a> (declaração de constante) <strong>não é parte do ECMAScript 5</strong>. É suportada no Firefox e no Chrome (V8) e parcialmente suportada no Opera 9+ e no Safari. <strong>Ela  não é suportada nas versões do Internet Explorer 6 ao 9, ou na versão <em>preview</em> do Internet Explorer 10</strong>. <a href="/pt-BR/JavaScript/Reference/Statements/const" title="en/JavaScript/Reference/Statements/const"><code>const</code></a> será definida no ECMAScript 6, mas com semânticas diferentes. Similarmente ao que acontece com variáveis definidas como <a href="/pt-BR/JavaScript/Reference/Statements/let" title="en/JavaScript/Reference/Statements/let"><code>let</code></a>, constantes declaradas com <a href="/pt-BR/JavaScript/Reference/Statements/const" title="en/JavaScript/Reference/Statements/const"><code>const</code></a> serão <em>block-scoped</em>, limitando seu escopo no bloco. <strong>Nós só usamos isso com propósito didático. Se você quer total compatibilidade com os navegadores, substitua todas as declarações <a href="/pt-BR/JavaScript/Reference/Statements/const" title="en/JavaScript/Reference/Statements/const"><code>const</code></a> por declarações <a href="/pt-BR/JavaScript/Reference/Statements/var" title="en/JavaScript/Reference/Statements/var"><code>var</code></a>.</strong></div>

<p>Para mais informações, veja: <a href="/pt-BR/docs/DOM/Manipulating_the_browser_history" title="/en-US/docs/DOM/Manipulating_the_browser_history">Manipulando o histórico do navegador</a>.</p>

<h2 id="Veja_também">Veja também</h2>

<ul>
 <li><a href="/pt-BR/docs/Web/API/Window/history"><code>window.history</code></a></li>
 <li><a href="/pt-BR/docs/Web/API/Window/onpopstate"><code>window.onpopstate</code></a></li>
</ul>
